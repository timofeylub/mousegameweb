<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MouseGame: –†–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π</title>
  
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Montserrat Semi Bold (600) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      background: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
      margin: 0;
      line-height: 1.4;
    }
    h1 {
      color: #0f0;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .section {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      text-align: left;
    }
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      justify-content: center;
    }
    .tool-btn {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 14px;
      padding: 8px 15px;
      cursor: pointer;
      background: #333;
      color: white;
      border: none;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .tool-btn.active {
      background: #0f8;
      color: #111;
    }
    .tool-btn:hover {
      background: #555;
    }
    .tool-btn i {
      font-size: 16px;
    }
    .strip-container {
      margin: 0 auto;
      width: max-content;
    }
    .strip {
      margin: 20px auto;
      width: max-content;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      padding: 10px;
      background: #1a1a1a;
      border-radius: 8px;
    }
    .row {
      display: flex;
      gap: 4px;
      margin-bottom: 8px;
    }
    .led {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      background: #222;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .led:hover {
      transform: scale(1.1);
    }
    .led.start {
      background: blue;
    }
    .led.finish {
      background: red;
    }
    .led.bag {
      background: orange;
    }
    .led.path {
      background: yellow;
    }
    .led.hole {
      background: green;
    }
    .led.editing {
      box-shadow: 0 0 5px 2px #f0f;
    }
    .code-output {
      background: #000;
      color: #0f0;
      text-align: left;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      margin: 20px 0;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .legend {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 15px 0;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 3px;
    }
    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    .level-settings {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }
    .setting {
      flex: 1;
    }
    label {
      display: block;
      margin: 5px 0 3px;
      color: #0f8;
      font-size: 14px;
    }
    input {
      width: 100%;
      padding: 5px;
      background: #222;
      border: 1px solid #444;
      color: #eee;
      border-radius: 4px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1>MouseGame: –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π</h1>
  <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É—Ä–æ–≤–Ω–∏, —Ä–∏—Å—É—è –ø—Ä—è–º–æ –Ω–∞ –ø–æ–ª–µ</p>

  <div class="toolbar">
    <button class="tool-btn active" data-mode="free">
      <span>‚úé</span> –°–≤–æ–±–æ–¥–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞
    </button>
    <button class="tool-btn" data-mode="hole">
      <span>üï≥Ô∏è</span> –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ—Ä
    </button>
    <button class="tool-btn" data-mode="select-finish">
      <span>‚öë</span> –í—ã–±—Ä–∞—Ç—å —Ñ–∏–Ω–∏—à
    </button>
    <button class="tool-btn" style="background: #800;" data-action="clear">
      <span>‚å´</span> –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ
    </button>
  </div>

  <div class="legend">
    <div class="legend-item">
      <div class="legend-color start"></div>
    </div>
    <div class="legend-item">
      <div class="legend-color finish"></div>
    </div>
    <div class="legend-item">
      <div class="legend-color bag"></div>
    </div>
    <div class="legend-item">
      <div class="legend-color path"></div>
    </div>
    <div class="legend-item">
      <div class="legend-color hole"></div>
    </div>
  </div>

  <div class="level-settings">
    <div class="setting">
      <label for="levelNum">–ù–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è</label>
      <input type="number" id="levelNum" min="1" value="3">
    </div>
    <div class="setting">
      <label for="levelName">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è</label>
      <input type="text" id="levelName" value="–°—Ä–µ–¥–Ω–∏–π">
    </div>
  </div>

  <div class="strip-container">
    <div class="strip" id="strip"></div>
  </div>

  <div class="controls">
    <button id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ —É—Ä–æ–≤–Ω—è</button>
    <button id="copyBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</button>
  </div>

  <div class="code-output" id="codeOutput">
    // –ö–æ–¥ —É—Ä–æ–≤–Ω—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞
  </div>

  <div class="section" style="background: #151515;">
    <h3 style="color: #0f8; margin-top: 0;">–ö–∞–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
    <p>1. –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –≤ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤</p>
    <p>2. –ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞–º –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è</p>
    <p>3. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∏ –Ω–æ—Ä: –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞–º, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –≤ –¥—Ä—É–≥–æ–π —Ä–µ–∂–∏–º</p>
    <p>4. –ù–∞–∂–º–∏—Ç–µ "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ —É—Ä–æ–≤–Ω—è"</p>
    <p style="color: #ff0;">üí° –°–æ–≤–µ—Ç: –°—Ç–∞—Ä—Ç –≤—Å–µ–≥–¥–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏ 0 (—Å–∏–Ω–∏–π —Å–≤–µ—Ç–æ–¥–∏–æ–¥)</p>
  </div>

  <script>
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    const NUM_LEDS = 180;
    const TOTAL_ROWS = 5;
    const ROWS = [
      { start: 0,   count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 0
      { start: 38,  count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 1
      { start: 76,  count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 2
      { start: 114, count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 3
      { start: 152, count: 28 }   // —Å—Ç—Ä–æ–∫–∞ 4
    ];

    // –¢–∏–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const ELEMENT_TYPES = {
      EMPTY: 180,
      START: 181,
      FINISH: 182,
      BAG: 183,
      PATH: 185,
      HOLE: 179  // –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–∏–ø –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–æ—Ä—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Å–µ—Ç—è—Ö
    };

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let networks = new Array(NUM_LEDS).fill(ELEMENT_TYPES.EMPTY);
    let currentMode = 'free'; // free, hole, select-finish
    let holeNetwork = [];
    let finishPos = 179;
    
    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const stripEl = document.getElementById('strip');
    const codeOutput = document.getElementById('codeOutput');
    const exportBtn = document.getElementById('exportBtn');
    const copyBtn = document.getElementById('copyBtn');
    const toolButtons = document.querySelectorAll('.tool-btn');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Å—Ç–∞—Ä—Ç –≤—Å–µ–≥–¥–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏ 0
    networks[0] = ELEMENT_TYPES.START;
    finishPos = 179;
    networks[finishPos] = ELEMENT_TYPES.FINISH;

    // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã
    function createStrip() {
      stripEl.innerHTML = '';
      
      ROWS.forEach(row => {
        const rowEl = document.createElement('div');
        rowEl.className = 'row';
        
        for (let i = row.start; i < row.start + row.count; i++) {
          const led = document.createElement('div');
          led.className = 'led';
          led.id = `led-${i}`;
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –∏ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø–æ–∑–∏—Ü–∏–π
          if (i === 0) led.classList.add('start');
          if (i === finishPos) led.classList.add('finish');
          
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
          led.addEventListener('click', () => handleLedClick(i));
          
          rowEl.appendChild(led);
        }
        
        stripEl.appendChild(rowEl);
      });
      
      updateVisuals();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    function updateVisuals() {
      for (let i = 0; i < NUM_LEDS; i++) {
        const led = document.getElementById(`led-${i}`);
        if (!led) continue;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã
        led.classList.remove('start', 'finish', 'bag', 'path', 'hole', 'editing');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        if (i === 0) {
          led.classList.add('start');
        } else if (i === finishPos) {
          led.classList.add('finish');
        } else if (networks[i] === ELEMENT_TYPES.BAG) {
          led.classList.add('bag');
        } else if (networks[i] === ELEMENT_TYPES.PATH) {
          led.classList.add('path');
        } else if (networks[i] < 180) { // –≠—Ç–æ –Ω–æ—Ä–∞
          led.classList.add('hole');
        }
        
        // –í—ã–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∏
        if (currentMode === 'hole' && holeNetwork.includes(i)) {
          led.classList.add('editing');
        }
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ —Å–≤–µ—Ç–æ–¥–∏–æ–¥—É
    function handleLedClick(pos) {
      if (pos === 0) return; // –°—Ç–∞—Ä—Ç –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å
      
      switch (currentMode) {
        case 'free':
          cycleElementType(pos);
          break;
        case 'hole':
          addToHoleNetwork(pos);
          break;
        case 'select-finish':
          setFinishPosition(pos);
          break;
      }
      
      updateVisuals();
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ (–≤ —Å–≤–æ–±–æ–¥–Ω–æ–º —Ä–µ–∂–∏–º–µ)
    function cycleElementType(pos) {
      // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∏–Ω–∏—à, —Å–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–Ω–∏—à
      if (pos === finishPos) {
        networks[pos] = ELEMENT_TYPES.EMPTY;
        finishPos = -1;
      }
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–∏–ø—ã
      switch (networks[pos]) {
        case ELEMENT_TYPES.EMPTY:
          networks[pos] = ELEMENT_TYPES.BAG;
          break;
        case ELEMENT_TYPES.BAG:
          networks[pos] = ELEMENT_TYPES.PATH;
          break;
        case ELEMENT_TYPES.PATH:
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∫ —Ñ–∏–Ω–∏—à, –µ—Å–ª–∏ —Ñ–∏–Ω–∏—à –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
          if (finishPos === -1) {
            networks[pos] = ELEMENT_TYPES.FINISH;
            finishPos = pos;
          } else {
            networks[pos] = ELEMENT_TYPES.EMPTY;
          }
          break;
        default:
          networks[pos] = ELEMENT_TYPES.EMPTY;
      }
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–µ—Ç—å –Ω–æ—Ä
    function addToHoleNetwork(pos) {
      // –ï—Å–ª–∏ —Å–≤–µ—Ç–æ–¥–∏–æ–¥ —É–∂–µ –≤ —Å–µ—Ç–∏, —É–¥–∞–ª—è–µ–º –µ–≥–æ
      const index = holeNetwork.indexOf(pos);
      if (index !== -1) {
        holeNetwork.splice(index, 1);
      } else {
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ—Ç—å
        holeNetwork.push(pos);
      }
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
    function setFinishPosition(pos) {
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ñ–∏–Ω–∏—à
      if (finishPos !== -1 && finishPos < NUM_LEDS) {
        networks[finishPos] = ELEMENT_TYPES.EMPTY;
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ñ–∏–Ω–∏—à
      finishPos = pos;
      networks[pos] = ELEMENT_TYPES.FINISH;
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Å–≤–æ–±–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º
      setMode('free');
      updateToolButtons();
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–∞
    function setMode(mode) {
      // –ï—Å–ª–∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ä–µ–∂–∏–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ—Ä –∏ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Å–µ—Ç—å
      if (currentMode === 'hole' && mode !== 'hole' && holeNetwork.length > 1) {
        saveHoleNetwork();
      }
      
      currentMode = mode;
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ—Ç—å –Ω–æ—Ä –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ä–µ–∂–∏–º–∞
      if (mode !== 'hole') {
        holeNetwork = [];
      }
      
      updateToolButtons();
      updateVisuals();
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Ç–∏ –Ω–æ—Ä
    function saveHoleNetwork() {
      if (holeNetwork.length < 2) return;
      
      // –°–æ–∑–¥–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é —Å–µ—Ç—å
      for (let i = 0; i < holeNetwork.length; i++) {
        const current = holeNetwork[i];
        const next = holeNetwork[(i + 1) % holeNetwork.length];
        networks[current] = next;
      }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ä–µ–∂–∏–º–æ–≤
    function updateToolButtons() {
      toolButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.mode === currentMode) {
          btn.classList.add('active');
        }
      });
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
    function clearField() {
      networks = new Array(NUM_LEDS).fill(ELEMENT_TYPES.EMPTY);
      networks[0] = ELEMENT_TYPES.START;
      finishPos = 179;
      networks[finishPos] = ELEMENT_TYPES.FINISH;
      holeNetwork = [];
      updateVisuals();
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —É—Ä–æ–≤–Ω—è
    function generateLevelCode() {
      const levelNum = document.getElementById('levelNum').value;
      const levelName = document.getElementById('levelName').value;
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
      if (!levelNum) {
        return '// –û—à–∏–±–∫–∞: –£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è';
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–¥ —É—Ä–æ–≤–Ω—è
      let code = `else if (level == ${levelNum}) {  // ${levelName}\n`;
      code += `    L_FINISH = ${finishPos};\n`;
      code += `    networks[0] = 181;\n`;
      code += `    networks[${finishPos}] = 182;\n`;
      code += `    currPos = 0;\n\n`;

      // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–µ—Ç–∏ –Ω–æ—Ä
      const holeNetworks = detectHoleNetworks();
      
      // –ì—Ä—É–ø–ø—ã –Ω–æ—Ä
      if (holeNetworks.length > 0) {
        code += `    // –°–µ—Ç–∏ –Ω–æ—Ä\n`;
        
        holeNetworks.forEach((network, index) => {
          const groupName = index + 1;
          
          // –°–æ–∑–¥–∞–µ–º —Ü–µ–ø–æ—á–∫—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–π
          for (let i = 0; i < network.length; i++) {
            const current = network[i];
            const next = network[(i + 1) % network.length];
            
            if (i === 0) {
              code += `    networks[${current}] = ${next}; // –ì—Ä—É–ø–ø–∞ ${groupName}\n`;
            } else {
              code += `    networks[${current}] = ${next};\n`;
            }
          }
          code += `\n`;
        });
      }

      // –ú–µ—à–∫–∏
      const bags = [];
      for (let i = 1; i < NUM_LEDS; i++) {
        if (networks[i] === ELEMENT_TYPES.BAG) {
          bags.push(i);
        }
      }
      
      if (bags.length > 0) {
        code += `    // –ú–µ—à–∫–∏\n`;
        bags.forEach(bag => {
          code += `    networks[${bag}] = 183;\n`;
        });
        code += `\n`;
      }

      // –¢—Ä–æ–ø–∏–Ω–∫–∏
      const paths = [];
      let currentPath = [];
      
      for (let i = 1; i < NUM_LEDS; i++) {
        if (networks[i] === ELEMENT_TYPES.PATH) {
          if (currentPath.length === 0 || i === currentPath[currentPath.length - 1] + 1) {
            currentPath.push(i);
          } else {
            paths.push([...currentPath]);
            currentPath = [i];
          }
        } else if (currentPath.length > 0) {
          paths.push([...currentPath]);
          currentPath = [];
        }
      }
      
      if (currentPath.length > 0) {
        paths.push(currentPath);
      }
      
      if (paths.length > 0) {
        code += `    // –¢—Ä–æ–ø–∏–Ω–∫–∏\n`;
        paths.forEach((path, index) => {
          const pathNum = index + 1;
          if (path.length === 1) {
            code += `    networks[${path[0]}] = 185;  // –¢—Ä–æ–ø–∏–Ω–∫–∞ ${pathNum}\n`;
          } else {
            code += `    for (int i = ${path[0]}; i <= ${path[path.length - 1]}; i++) networks[i] = 185;  // –¢—Ä–æ–ø–∏–Ω–∫–∞ ${pathNum}\n`;
          }
        });
      }

      code += `  }`;
      return code;
    }

    // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Ç–µ–π –Ω–æ—Ä
    function detectHoleNetworks() {
      const visited = new Array(NUM_LEDS).fill(false);
      const networksList = [];
      
      // –ó–∞—Ç–µ–º –∏—â–µ–º —Å–µ—Ç–∏ –≤ –º–∞—Å—Å–∏–≤–µ networks
      for (let i = 1; i < NUM_LEDS; i++) {
        if (networks[i] < 180 && !visited[i]) {
          const network = [];
          let current = i;
          
          while (!visited[current]) {
            visited[current] = true;
            network.push(current);
            current = networks[current];
          }
          
          if (network.length > 1) {
            networksList.push(network);
          }
        }
      }
      
      return networksList;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.addEventListener('DOMContentLoaded', function() {
      // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã
      createStrip();
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —Ä–µ–∂–∏–º–æ–≤
      toolButtons.forEach(btn => {
        if (btn.dataset.mode) {
          btn.addEventListener('click', () => setMode(btn.dataset.mode));
        }
        if (btn.dataset.action === 'clear') {
          btn.addEventListener('click', clearField);
        }
      });
      
      // –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–¥–∞
      exportBtn.addEventListener('click', () => {
        const code = generateLevelCode();
        codeOutput.textContent = code;
      });
      
      // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä
      copyBtn.addEventListener('click', () => {
        const text = codeOutput.textContent;
        navigator.clipboard.writeText(text).then(() => {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
          setTimeout(() => {
            copyBtn.textContent = originalText;
          }, 2000);
        });
      });
    });
  </script>
</body>
</html>
