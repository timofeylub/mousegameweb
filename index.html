<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MouseGame: –≠–º—É–ª—è—Ç–æ—Ä, –†–µ–¥–∞–∫—Ç–æ—Ä –∏ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π</title>
  
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Montserrat Semi Bold (600) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      background: #111;
      color: #eee;
      text-align: center;
      padding: 20px;
      margin: 0;
      line-height: 1.4;
      min-height: 100vh;
      position: relative;
      padding-bottom: 60px;
    }
    
    h1 {
      color: #0f0;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 5px;
      margin: 20px 0;
      background: linear-gradient(135deg, #1a1a1a 0%, #222 100%);
      padding: 10px;
      border-radius: 12px;
      border: 1px solid #333;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .tab-btn {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 14px;
      padding: 12px 24px;
      cursor: pointer;
      background: #333;
      color: white;
      border: none;
      border-radius: 8px;
      transition: all 0.3s;
      flex: 1;
      max-width: 200px;
    }
    
    .tab-btn:hover {
      background: #555;
      transform: translateY(-2px);
    }
    
    .tab-btn.active {
      background: #0f8;
      color: #111;
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
    }
    
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ */
    .section {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
    }
    
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      justify-content: center;
    }
    
    .tool-btn {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 14px;
      padding: 10px 18px;
      cursor: pointer;
      background: #333;
      color: white;
      border: none;
      border-radius: 8px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .tool-btn:hover {
      background: #555;
      transform: translateY(-2px);
    }
    
    .tool-btn.active {
      background: #0f8;
      color: #111;
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
    }
    
    .action-btn {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 15px;
      padding: 12px 24px;
      cursor: pointer;
      background: #2a2a2a;
      color: white;
      border: 2px solid #0f8;
      border-radius: 8px;
      transition: all 0.3s;
    }
    
    .action-btn:hover {
      background: #0f8;
      color: #111;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 255, 136, 0.4);
    }
    
    .action-btn:active {
      transform: translateY(0);
    }
    
    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-top: 20px;
    }
    
    .code-output {
      background: #000;
      color: #0f0;
      text-align: left;
      padding: 20px;
      border-radius: 8px;
      font-family: monospace;
      margin: 20px 0;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
      font-size: 13px;
      line-height: 1.4;
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 18px;
      border-radius: 8px;
      z-index: 1000;
      animation: fadeInOut 2s ease-in-out;
      border: 1px solid #0f8;
    }
    
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(-10px); }
      10% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-10px); }
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–æ—Å—ã —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤ */
    .strip-container {
      margin: 0 auto;
      width: max-content;
      max-width: 100%;
      overflow-x: auto;
    }
    
    .strip {
      margin: 20px auto;
      width: max-content;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      padding: 15px;
      background: #1a1a1a;
      border-radius: 12px;
    }
    
    .row {
      display: flex;
      gap: 3px; /* –£–º–µ–Ω—å—à–µ–Ω gap –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –ø–æ–ª—è */
      margin-bottom: 6px; /* –£–º–µ–Ω—å—à–µ–Ω margin –¥–ª—è –±–æ–ª—å—à–µ–≥–æ –ø–æ–ª—è */
    }
    
    .led {
      width: 26px; /* –£–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞ */
      height: 26px; /* –£–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä —Å–≤–µ—Ç–æ–¥–∏–æ–¥–∞ */
      border-radius: 5px; /* –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–µ–Ω —Ä–∞–¥–∏—É—Å */
      background: #222;
      cursor: pointer;
      transition: transform 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px; /* –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–µ–Ω —à—Ä–∏—Ñ—Ç */
      font-weight: bold;
      border: 1px solid transparent;
      position: relative;
    }
    
    .led:hover {
      transform: scale(1.15);
    }
    
    .led.start {
      background: blue;
      color: white;
    }
    
    .led.finish {
      background: red;
      color: white;
    }
    
    .led.bag {
      background: orange;
      color: white;
    }
    
    .led.path {
      background: yellow;
      color: #111;
    }
    
    .led.hole {
      background: #222 !important;
      border-width: 2px;
    }
    
    .led.hole-number {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 9px; /* –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–µ–Ω —à—Ä–∏—Ñ—Ç */
      font-weight: bold;
      pointer-events: none;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Ä–æ–≤–Ω—è */
    .level-settings {
      display: flex;
      gap: 20px;
      margin-top: 15px;
    }
    
    .setting {
      flex: 1;
    }
    
    label {
      display: block;
      margin: 8px 0 5px;
      color: #0f8;
      font-size: 14px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 10px;
      background: #222;
      border: 1px solid #444;
      color: #eee;
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 14px;
    }
    
    textarea {
      min-height: 140px;
      resize: vertical;
    }
    
    .status {
      color: #ff0;
      font-weight: 600;
      margin: 15px 0;
      font-size: 16px;
      text-align: center;
      min-height: 24px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ */
    .visual-controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .visual-control {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #222;
      padding: 10px 18px;
      border-radius: 25px;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    .visual-control:hover {
      background: #333;
      border-color: #0f8;
    }
    
    .visual-control input[type="checkbox"] {
      appearance: none;
      -webkit-appearance: none;
      width: 22px;
      height: 22px;
      background: #444;
      border: 2px solid #666;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s;
    }
    
    .visual-control input[type="checkbox"]:checked {
      background: #0f8;
      border-color: #0f8;
    }
    
    .visual-control input[type="checkbox"]:checked::after {
      content: "‚úì";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #111;
      font-weight: bold;
      font-size: 16px;
    }
    
    .visual-control label {
      cursor: pointer;
      color: #eee;
      margin: 0;
      font-size: 14px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Ö–µ–º—ã */
    .scheme {
      margin: 20px auto;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 12px;
      max-width: 650px;
    }
    
    .scheme-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding: 8px;
      border-radius: 6px;
      background: #222;
    }
    
    .scheme-direction {
      font-size: 14px;
      color: #0f8;
    }
    
    .scheme-info {
      font-size: 13px;
      color: #aaa;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ª–µ–≥–µ–Ω–¥—ã */
    .legend-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin: 25px auto;
      max-width: 650px;
    }
    
    .legend-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      background: #222;
      padding: 12px;
      border-radius: 10px;
      transition: all 0.3s;
    }
    
    .legend-item:hover {
      background: #333;
      transform: translateY(-3px);
    }
    
    .legend-color {
      width: 35px;
      height: 35px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: bold;
    }
    
    .legend-text {
      font-size: 13px;
      color: #ccc;
      text-align: center;
      line-height: 1.3;
    }
    
    .legend-color.start {
      background: blue;
      color: white;
    }
    
    .legend-color.finish {
      background: red;
      color: white;
    }
    
    .legend-color.bag {
      background: orange;
      color: white;
    }
    
    .legend-color.path {
      background: yellow;
      color: #111;
    }
    
    .legend-color.hole {
      background: #222;
      border: 2px solid #888;
      color: white;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–µ—Ç–µ–π */
    .networks-list {
      background: #222;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .network-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      padding: 8px;
      background: #333;
      border-radius: 6px;
    }
    
    .network-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      border: 2px solid;
    }
    
    .network-info {
      font-size: 13px;
      color: #ccc;
    }
    
    /* –ü–æ–¥–≤–∞–ª */
    footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50px;
      background: #1a1a1a;
      color: #888;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      border-top: 1px solid #333;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    @media (max-width: 768px) {
      .level-settings {
        flex-direction: column;
      }
      
      .visual-controls {
        flex-direction: column;
        align-items: center;
      }
      
      .legend-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .tab-btn {
        padding: 10px 12px;
        font-size: 13px;
      }
      
      .led {
        width: 22px; /* –ù–µ–º–Ω–æ–≥–æ —É–º–µ–Ω—å—à–∞–µ–º –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        height: 22px;
      }
      
      .tool-btn {
        padding: 8px 12px;
        font-size: 13px;
      }
    }
    
    /* –ö–Ω–æ–ø–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å —à–µ—Å—Ç–µ—Ä–µ–Ω–∫–æ–π */
    .settings-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: #333;
      border: 1px solid #444;
      border-radius: 8px;
      cursor: pointer;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .settings-btn:hover .gear-icon {
      transform: rotate(30deg);
    }
    
    .settings-btn:hover {
      background: #444;
    }
    
    .gear-icon {
      width: 20px;
      height: 20px;
      fill: #0f8;
      transition: transform 0.3s;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
    .settings-modal {
      display: none;
      position: fixed;
      top: 70px;
      right: 20px;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 12px;
      padding: 20px;
      z-index: 1001;
      width: 300px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    }
    
    .setting-item {
      margin: 15px 0;
    }
    
    .setting-item label {
      display: block;
      margin-bottom: 8px;
      color: #0f8;
      font-size: 14px;
    }
    
    /* –ü–æ–¥–ª–æ–∂–∫–∞ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
    .editor-tools-container {
      background: #222;
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –≥—Ä—É–ø–ø—ã —Å–≤–æ–±–æ–¥–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏ */
    .free-tool-group {
      position: relative;
      min-width: 200px;
    }
    
    /* –ú–∞–ª–µ–Ω—å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ —Ç—Ä–æ–ø—ã –∏ –º–µ—à–∫–∞ */
    .sub-toolbar {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      justify-content: center;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.05);
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #333;
      width: 100%;
    }
    
    .small-tool {
      padding: 6px 12px;
      background: #333;
      border: 2px solid transparent;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
      color: #ccc;
      font-weight: 600;
      flex: 1;
      min-width: 70px;
      justify-content: center;
    }
    
    .small-tool:hover {
      background: #444;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .small-tool.active {
      background: #0f8;
      color: #111;
      border-color: #0f8;
      box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
    }
    
    /* –ü–æ–ª–∑—É–Ω–∫–∏ –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ */
    .range-sliders {
      display: grid;
      gap: 15px;
      margin: 20px 0;
    }
    
    .slider-container {
      background: #222;
      padding: 15px;
      border-radius: 10px;
    }
    
    .slider-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .slider-value {
      color: #0f8;
      font-weight: bold;
    }
    
    input[type="range"] {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      background: #333;
      border-radius: 4px;
      outline: none;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: #0f8;
      border-radius: 50%;
      cursor: pointer;
    }
    
    /* –°–ø–æ–π–ª–µ—Ä –¥–ª—è —Ä–µ—à–µ–Ω–∏—è */
    .spoiler {
      margin: 20px 0;
    }
    
    .spoiler-header {
      background: #222;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border: 1px solid #333;
      transition: all 0.3s;
    }
    
    .spoiler-header:hover {
      background: #2a2a2a;
    }
    
    .spoiler-content {
      display: none;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 0 0 8px 8px;
      border: 1px solid #333;
      border-top: none;
    }
    
    .spoiler.open .spoiler-content {
      display: block;
    }
    
    .spoiler-arrow {
      transition: transform 0.3s;
    }
    
    .spoiler.open .spoiler-arrow {
      transform: rotate(180deg);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —à–∞–≥–æ–≤ —Ä–µ—à–µ–Ω–∏—è */
    .solution-step {
      margin: 12px 0;
      padding-left: 20px;
      border-left: 3px solid #0f8;
      font-size: 14px;
    }
    
    .step-number {
      display: inline-block;
      width: 26px;
      height: 26px;
      background: #0f8;
      color: #111;
      border-radius: 50%;
      text-align: center;
      margin-right: 12px;
      font-weight: bold;
      line-height: 26px;
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ—à–µ–Ω–∏—è —ç–º—É–ª—è—Ç–æ—Ä–∞ */
    .solution-container {
      background: #151515;
      border-radius: 12px;
      padding: 20px;
      margin-top: 25px;
    }
    
    .solution-title {
      color: #0f8;
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>MouseGame: –≠–º—É–ª—è—Ç–æ—Ä, –†–µ–¥–∞–∫—Ç–æ—Ä –∏ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π</h1>

  <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <button class="settings-btn" id="settingsBtn">
    <svg class="gear-icon" viewBox="0 0 24 24">
      <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
    </svg>
  </button>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <div class="settings-modal" id="settingsModal">
    <h3 style="color: #0f8; margin-top: 0;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    
    <div class="setting-item">
      <label for="holeIndexStyle">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –Ω–æ—Ä:</label>
      <select id="holeIndexStyle">
        <option value="network">–ù–æ–º–µ—Ä –≤ —Å–µ—Ç–∏</option>
        <option value="global">–ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å</option>
        <option value="both">–û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞</option>
      </select>
    </div>
    
    <div class="setting-item">
      <label for="solutionSpeed">–°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞ —Ä–µ—à–µ–Ω–∏—è:</label>
      <select id="solutionSpeed">
        <option value="500">–ú–µ–¥–ª–µ–Ω–Ω–æ</option>
        <option value="300" selected>–°—Ä–µ–¥–Ω–µ</option>
        <option value="100">–ë—ã—Å—Ç—Ä–æ</option>
      </select>
    </div>
    
    <button class="action-btn" id="closeSettings" style="width: 100%; margin-top: 20px;">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <div class="tabs">
    <button class="tab-btn" data-tab="emulator">–≠–º—É–ª—è—Ç–æ—Ä</button>
    <button class="tab-btn active" data-tab="editor">–†–µ–¥–∞–∫—Ç–æ—Ä</button>
    <button class="tab-btn" data-tab="generator">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</button>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ –≠–º—É–ª—è—Ç–æ—Ä–∞ -->
  <div id="emulator" class="tab-content">
    <div class="section">
      <h3 style="color: #0f8; margin-top: 0; text-align: center;">–≠–º—É–ª—è—Ç–æ—Ä –∏–≥—Ä—ã MouseGame</h3>
      <div class="status" id="emulatorStatus">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –¥–ª—è –∏–≥—Ä—ã</div>
      
      <div class="level-settings">
        <div class="setting">
          <label for="emulatorLevel">–£—Ä–æ–≤–µ–Ω—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</label>
          <select id="emulatorLevel">
            <option value="1">–£—Ä–æ–≤–µ–Ω—å 1 (–õ–µ–≥–∫–∏–π)</option>
            <option value="2">–£—Ä–æ–≤–µ–Ω—å 2 (–°—Ä–µ–¥–Ω–∏–π)</option>
            <option value="3">–£—Ä–æ–≤–µ–Ω—å 3 (–°–ª–æ–∂–Ω—ã–π)</option>
            <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å</option>
          </select>
        </div>
      </div>
      
      <div id="customLevelSection" style="display: none;">
        <div class="setting">
          <label for="emulatorCustomCode">–ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è</label>
          <textarea id="emulatorCustomCode" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ —É—Ä–æ–≤–Ω—è (else if (level == X) { ... })"></textarea>
        </div>
        <div class="controls">
          <button class="action-btn" id="loadEmulatorLevel">–ó–∞–≥—Ä—É–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –≤ —ç–º—É–ª—è—Ç–æ—Ä</button>
        </div>
      </div>
      
      <div class="controls">
        <button class="action-btn" id="emulatorReset">‚Üª –°–±—Ä–æ—Å —É—Ä–æ–≤–Ω—è</button>
        <button class="action-btn" id="emulatorSolution">üîç –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ</button>
      </div>
    </div>
    
    <div class="section">
      <div class="strip-container">
        <div class="strip" id="emulatorStrip"></div>
      </div>
      
      <div class="controls">
        <button class="action-btn" id="emulatorLeft">‚Üê –í–ª–µ–≤–æ</button>
        <button class="action-btn" id="emulatorCenter">–ó–∞–Ω—ã—Ä–Ω—É—Ç—å</button>
        <button class="action-btn" id="emulatorRight">–í–ø—Ä–∞–≤–æ ‚Üí</button>
      </div>
    </div>
    
    <!-- –°–ø–æ–π–ª–µ—Ä —Å —Ä–µ—à–µ–Ω–∏–µ–º -->
    <div class="spoiler" id="emulatorSpoiler">
      <div class="spoiler-header" onclick="toggleSpoiler('emulatorSpoiler')">
        <span>–†–µ—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è</span>
        <span class="spoiler-arrow">‚ñº</span>
      </div>
      <div class="spoiler-content" id="emulatorSolutionContainer">
        <div id="emulatorSolutionSteps"></div>
      </div>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ –†–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
  <div id="editor" class="tab-content active">
    <div class="section">
      <h3 style="color: #0f8; margin-top: 0; text-align: center;">–†–µ–¥–∞–∫—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π MouseGame</h3>
      
      <div class="editor-tools-container">
        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã -->
        <div class="toolbar">
          <button class="tool-btn" data-mode="none">
            <span>‚úñ</span> –ù–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
          </button>
          
          <!-- –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Å–≤–æ–±–æ–¥–Ω—É—é —Ä–∞–∑–º–µ—Ç–∫—É —Å –º–∞–ª–µ–Ω—å–∫–∏–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ -->
          <div class="free-tool-group">
            <button class="tool-btn active" data-mode="free" id="freeToolBtn" style="width: 100%;">
              <span>‚úé</span> –°–≤–æ–±–æ–¥–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞
            </button>
            
            <!-- –ú–∞–ª–µ–Ω—å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ —Ç—Ä–æ–ø—ã –∏ –º–µ—à–∫–∞ - –ü–†–Ø–ú–û –ü–û–î —Å–≤–æ–±–æ–¥–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–æ–π -->
            <div class="sub-toolbar" style="display: none;">
              <div class="small-tool" data-quick="path" style="color: yellow;">
                <span>T</span> –¢—Ä–æ–ø–∞
              </div>
              <div class="small-tool" data-quick="bag" style="color: orange;">
                <span>M</span> –ú–µ—à–æ–∫
              </div>
            </div>
          </div>
          
          <button class="tool-btn" data-mode="hole">
            <span>üï≥Ô∏è</span> –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ—Ä
          </button>
          <button class="tool-btn" data-mode="select-finish">
            <span>‚öë</span> –í—ã–±—Ä–∞—Ç—å —Ñ–∏–Ω–∏—à
          </button>
          <button class="tool-btn" data-mode="info" style="background: #0080ff;">
            <span>‚Ñπ</span> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
          </button>
          <button class="tool-btn" style="background: #800;" data-action="clear">
            <span>‚å´</span> –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ
          </button>
        </div>
      </div>

      <div class="level-settings">
        <div class="setting">
          <label for="levelNum">–ù–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è</label>
          <input type="number" id="levelNum" min="1" value="3">
        </div>
        <div class="setting">
          <label for="levelName">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è (–∏–ª–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å)</label>
          <input type="text" id="levelName" value="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è">
        </div>
      </div>

      <div class="visual-controls">
        <div class="visual-control">
          <input type="checkbox" id="showAllIndices">
          <label for="showAllIndices">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤—Å–µ—Ö –∫–ª–µ—Ç–æ–∫ (0-179)</label>
        </div>
        <div class="visual-control">
          <input type="checkbox" id="showHoleIndices">
          <label for="showHoleIndices">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–æ—Ä (0-179)</label>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="strip-container">
        <div class="strip" id="editorStrip"></div>
      </div>
    </div>

    <div class="section" id="infoPanel" style="display: none;">
      <h3 style="color: #0f8; margin-top: 0;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–µ—Ç–∫–µ</h3>
      <div id="infoDetails" style="font-family: monospace; font-size: 14px; line-height: 1.5;"></div>
    </div>
    
    <div class="section networks-list" id="networksList" style="display: none;">
      <h4 style="color: #0f8; margin-top: 0;">–¢–µ–∫—É—â–∏–µ —Å–µ—Ç–∏ –Ω–æ—Ä:</h4>
      <div id="networksListContent"></div>
    </div>

    <div class="controls">
      <button class="action-btn" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ —É—Ä–æ–≤–Ω—è</button>
      <button class="action-btn" id="exportToEmulatorBtn">–≠–∫—Å–ø–æ—Ä—Ç –≤ —ç–º—É–ª—è—Ç–æ—Ä</button>
      <button class="action-btn" id="copyBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä</button>
    </div>

    <div class="section">
      <div class="code-output" id="codeOutput">
        // –ö–æ–¥ —É—Ä–æ–≤–Ω—è –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞
      </div>
    </div>

    <div class="legend-grid">
      <div class="legend-item">
        <div class="legend-color start"></div>
        <div class="legend-text">–°—Ç–∞—Ä—Ç (–ø–æ–∑–∏—Ü–∏—è 0)</div>
      </div>
      <div class="legend-item">
        <div class="legend-color finish"></div>
        <div class="legend-text">–§–∏–Ω–∏—à</div>
      </div>
      <div class="legend-item">
        <div class="legend-color bag"></div>
        <div class="legend-text">–ú–µ—à–æ–∫</div>
      </div>
      <div class="legend-item">
        <div class="legend-color path"></div>
        <div class="legend-text">–¢—Ä–æ–ø–∏–Ω–∫–∞</div>
      </div>
      <div class="legend-item">
        <div class="legend-color hole">1</div>
        <div class="legend-text">–ù–æ—Ä–∞ (–Ω–æ–º–µ—Ä –≤ —Å–µ—Ç–∏)</div>
      </div>
    </div>

    <div class="scheme">
      <h3 style="color: #0f8; margin-top: 0; text-align: center;">–°—Ö–µ–º–∞ –∑–º–µ–π–∫–∏ (180 —Å–≤–µ—Ç–æ–¥–∏–æ–¥–æ–≤)</h3>
      <div class="scheme-row">
        <div class="scheme-direction">‚Üí –°–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ</div>
        <div class="scheme-info">–°—Ç—Ä–æ–∫–∞ 1: —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã 0-37 (38 —à—Ç)</div>
      </div>
      <div class="scheme-row">
        <div class="scheme-direction">‚Üê –°–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ</div>
        <div class="scheme-info">–°—Ç—Ä–æ–∫–∞ 2: —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã 38-75 (38 —à—Ç)</div>
      </div>
      <div class="scheme-row">
        <div class="scheme-direction">‚Üí –°–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ</div>
        <div class="scheme-info">–°—Ç—Ä–æ–∫–∞ 3: —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã 76-113 (38 —à—Ç)</div>
      </div>
      <div class="scheme-row">
        <div class="scheme-direction">‚Üê –°–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ</div>
        <div class="scheme-info">–°—Ç—Ä–æ–∫–∞ 4: —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã 114-151 (38 —à—Ç)</div>
      </div>
      <div class="scheme-row">
        <div class="scheme-direction">‚Üí –°–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ</div>
        <div class="scheme-info">–°—Ç—Ä–æ–∫–∞ 5: —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã 152-179 (28 —à—Ç)</div>
      </div>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∞ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ -->
  <div id="generator" class="tab-content">
    <div class="section">
      <h3 style="color: #0f8; margin-top: 0; text-align: center;">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω–µ–π MouseGame</h3>
      
      <div class="level-settings">
        <div class="setting">
          <label for="generatorLevelNum">–ù–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è</label>
          <input type="number" id="generatorLevelNum" min="1" value="6">
        </div>
        <div class="setting">
          <label for="generatorLevelName">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è (–∏–ª–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å)</label>
          <input type="text" id="generatorLevelName" value="–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è">
        </div>
      </div>
      
      <div class="range-sliders">
        <div class="slider-container">
          <div class="slider-label">
            <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–æ–ø</span>
            <span class="slider-value" id="pathCountValue">3</span>
          </div>
          <input type="range" min="0" max="10" value="3" class="slider" id="pathCountSlider">
        </div>
        
        <div class="slider-container">
          <div class="slider-label">
            <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—à–∫–æ–≤</span>
            <span class="slider-value" id="bagCountValue">5</span>
          </div>
          <input type="range" min="0" max="20" value="5" class="slider" id="bagCountSlider">
        </div>
        
        <div class="slider-container">
          <div class="slider-label">
            <span>–ù–æ—Ä –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏</span>
            <span class="slider-value" id="holePerNetworkValue">3</span>
          </div>
          <input type="range" min="2" max="8" value="3" class="slider" id="holePerNetworkSlider">
        </div>
        
        <div class="slider-container">
          <div class="slider-label">
            <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Ç–µ–π –Ω–æ—Ä</span>
            <span class="slider-value" id="networkCountValue">4</span>
          </div>
          <input type="range" min="1" max="10" value="4" class="slider" id="networkCountSlider">
        </div>
      </div>
      
      <div class="status" id="generatorStatus">–ì–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω–µ–π</div>
      
      <div class="controls">
        <button class="action-btn" id="generateBtn">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</button>
        <button class="action-btn" id="generatorCopyBtn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
        <button class="action-btn" id="generatorLoadBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä</button>
        <button class="action-btn" id="generatorLoadEmulatorBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ —ç–º—É–ª—è—Ç–æ—Ä</button>
      </div>
    </div>
    
    <div class="section">
      <h3 style="color: #0f8; margin-top: 0; margin-bottom: 15px;">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —É—Ä–æ–≤–Ω—è</h3>
      <div class="strip-container">
        <div class="strip" id="generatorStrip"></div>
      </div>
    </div>
    
    <div class="section">
      <h3 style="color: #0f8; margin-top: 0; margin-bottom: 15px;">–ö–æ–¥ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è</h3>
      <div class="code-output" id="generatorCodeOutput">
        // –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
      </div>
    </div>
    
    <div class="section">
      <div class="spoiler" id="generatorSpoiler">
        <div class="spoiler-header" onclick="toggleSpoiler('generatorSpoiler')">
          <span>–ö–∞–∫ –ø—Ä–æ–π—Ç–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å:</span>
          <span class="spoiler-arrow">‚ñº</span>
        </div>
        <div class="spoiler-content">
          <div id="generatorSolutionSteps">
            <p>–†–µ—à–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div>–¢–∏–º–æ—Ñ–µ–π –õ—é–±—É—à–∫–∏–Ω, 2026</div>
  </footer>

  <script>
    // =============================================
    // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï
    // =============================================
    
    const NUM_LEDS = 180;
    const TOTAL_ROWS = 5;
    const ROWS = [
      { start: 0,   count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 0
      { start: 38,  count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 1
      { start: 76,  count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 2
      { start: 114, count: 38 },  // —Å—Ç—Ä–æ–∫–∞ 3
      { start: 152, count: 28 }   // —Å—Ç—Ä–æ–∫–∞ 4
    ];

    // –¢–∏–ø—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const ELEMENT_TYPES = {
      EMPTY: 180,
      START: 181,
      FINISH: 182,
      BAG: 183,
      PATH: 185,
      HOLE: 179
    };

    // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Å–µ—Ç–µ–π –Ω–æ—Ä (24 —Ü–≤–µ—Ç–∞)
    const NETWORK_COLORS = [
      '#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF',
      '#FF8000', '#8000FF', '#0080FF', '#FF0080', '#80FF00', '#008080',
      '#FF3333', '#33FF33', '#3333FF', '#FFFF33', '#FF33FF', '#33FFFF',
      '#FF9933', '#9933FF', '#3399FF', '#FF3399', '#99FF33', '#33FF99'
    ];

    // =============================================
    // –§–£–ù–ö–¶–ò–ò –û–ë–©–ï–ì–û –ù–ê–ó–ù–ê–ß–ï–ù–ò–Ø
    // =============================================

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 2000);
    }

    // –ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç –¥–ª—è —Å–µ—Ç–∏ –ø–æ –∏–Ω–¥–µ–∫—Å—É
    function getNetworkColor(networkIndex) {
      return NETWORK_COLORS[networkIndex % NETWORK_COLORS.length];
    }

    // –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫—É –ø–æ –ø–æ–∑–∏—Ü–∏–∏
    function getRow(pos) {
      if (pos < 38) return 0;   // –°—Ç—Ä–æ–∫–∞ 0
      if (pos < 76) return 1;   // –°—Ç—Ä–æ–∫–∞ 1
      if (pos < 114) return 2;  // –°—Ç—Ä–æ–∫–∞ 2
      if (pos < 152) return 3;  // –°—Ç—Ä–æ–∫–∞ 3
      return 4;                 // –°—Ç—Ä–æ–∫–∞ 4 (–∫–æ—Ä–æ—Ç–∫–∞—è)
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–ø–æ–π–ª–µ—Ä–∞
    function toggleSpoiler(spoilerId) {
      const spoiler = document.getElementById(spoilerId);
      spoiler.classList.toggle('open');
    }

    // =============================================
    // –£–ü–†–ê–í–õ–ï–ù–ò–ï –í–ö–õ–ê–î–ö–ê–ú–ò –ò –ù–ê–°–¢–†–û–ô–ö–ê–ú–ò
    // =============================================

    document.addEventListener('DOMContentLoaded', function() {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–æ–∫
      const tabButtons = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          const tabId = button.dataset.tab;
          
          // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Ç–µ–∫—É—â–µ–π –∫–Ω–æ–ø–∫–µ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
          button.classList.add('active');
          document.getElementById(tabId).classList.add('active');
          
          // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
          document.getElementById('settingsModal').style.display = 'none';
          
          // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          if (tabId === 'editor') {
            updateVisuals();
            updateNetworksList();
          }
          
          // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          if (tabId === 'emulator') {
            updateEmulatorDisplay();
          }
          
          // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          if (tabId === 'generator') {
            updateGeneratorDisplay();
          }
        });
      });
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
      initEditor();
      initEmulator();
      initGenerator();
      initSmallTools();
      initGeneratorSliders();
      initSettings();
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–æ—Ä –≤ –ª–µ–≥–µ–Ω–¥–µ
      const holeLegend = document.querySelector('.legend-text');
      if (holeLegend && holeLegend.textContent.includes('—Ü–∏—Ñ—Ä–∞ - –Ω–æ–º–µ—Ä –≤ —Å–µ—Ç–∏')) {
        holeLegend.textContent = '–ù–æ—Ä–∞ (–Ω–æ–º–µ—Ä –≤ —Å–µ—Ç–∏)';
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function initSettings() {
      const settingsBtn = document.getElementById('settingsBtn');
      const settingsModal = document.getElementById('settingsModal');
      const closeSettings = document.getElementById('closeSettings');
      
      if (settingsBtn && settingsModal && closeSettings) {
        settingsBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          settingsModal.style.display = settingsModal.style.display === 'block' ? 'none' : 'block';
        });
        
        closeSettings.addEventListener('click', function() {
          settingsModal.style.display = 'none';
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        document.addEventListener('click', function(event) {
          if (!settingsModal.contains(event.target) && 
              !settingsBtn.contains(event.target) &&
              settingsModal.style.display === 'block') {
            settingsModal.style.display = 'none';
          }
        });
      }
    }

    // =============================================
    // –†–ï–î–ê–ö–¢–û–† –£–†–û–í–ù–ï–ô
    // =============================================

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    let networks = new Array(NUM_LEDS).fill(ELEMENT_TYPES.EMPTY);
    let currentMode = 'free'; // none, free, hole, select-finish, info
    let holeNetwork = [];
    let holeNetworks = []; // –ú–∞—Å—Å–∏–≤ –≤—Å–µ—Ö —Å–µ—Ç–µ–π –Ω–æ—Ä
    let finishPos = 179;
    let showAllIndices = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –≤—Å–µ—Ö –∫–ª–µ—Ç–æ–∫
    let showHoleIndices = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–æ—Ä
    let currentQuickTool = null; // –ë—ã—Å—Ç—Ä—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: null, 'path', 'bag'
    
    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    const editorStripEl = document.getElementById('editorStrip');
    const codeOutput = document.getElementById('codeOutput');
    const exportBtn = document.getElementById('exportBtn');
    const exportToEmulatorBtn = document.getElementById('exportToEmulatorBtn');
    const copyBtn = document.getElementById('copyBtn');
    const toolButtons = document.querySelectorAll('.toolbar .tool-btn');
    const smallTools = document.querySelectorAll('.small-tool');
    const infoPanel = document.getElementById('infoPanel');
    const infoDetails = document.getElementById('infoDetails');
    const showAllIndicesCheckbox = document.getElementById('showAllIndices');
    const showHoleIndicesCheckbox = document.getElementById('showHoleIndices');
    const networksList = document.getElementById('networksList');
    const networksListContent = document.getElementById('networksListContent');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    function initEditor() {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Å—Ç–∞—Ä—Ç –≤—Å–µ–≥–¥–∞ –≤ –ø–æ–∑–∏—Ü–∏–∏ 0
      networks[0] = ELEMENT_TYPES.START;
      finishPos = 179;
      networks[finishPos] = ELEMENT_TYPES.FINISH;
      
      // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã
      createEditorStrip();
      
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      updateToolButtons();
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      toolButtons.forEach(btn => {
        if (btn.dataset.mode) {
          btn.addEventListener('click', () => {
            setMode(btn.dataset.mode);
          });
        }
        if (btn.dataset.action === 'clear') {
          btn.addEventListener('click', clearField);
        }
      });
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –∏–Ω–¥–µ–∫—Å–æ–≤
      showAllIndicesCheckbox.addEventListener('change', toggleAllIndices);
      showHoleIndicesCheckbox.addEventListener('change', toggleHoleIndices);
      
      // –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–¥–∞
      exportBtn.addEventListener('click', () => {
        const code = generateLevelCode();
        codeOutput.textContent = code;
        showNotification('–ö–æ–¥ —É—Ä–æ–≤–Ω—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
      });
      
      // –≠–∫—Å–ø–æ—Ä—Ç –≤ —ç–º—É–ª—è—Ç–æ—Ä
      exportToEmulatorBtn.addEventListener('click', function() {
        const code = generateLevelCode();
        if (code.includes('// –û—à–∏–±–∫–∞')) {
          showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å');
          return;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä
        document.querySelector('[data-tab="emulator"]').click();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
        document.getElementById('emulatorLevel').value = 'custom';
        document.getElementById('customLevelSection').style.display = 'block';
        document.getElementById('emulatorCustomCode').value = code;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–≤–µ–Ω—å
        loadCustomLevelToEmulator();
        
        showNotification('–£—Ä–æ–≤–µ–Ω—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ —ç–º—É–ª—è—Ç–æ—Ä');
      });
      
      // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä
      copyBtn.addEventListener('click', () => {
        const text = codeOutput.textContent;
        if (!text || text.includes('// –û—à–∏–±–∫–∞')) {
          showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–æ–¥ —É—Ä–æ–≤–Ω—è');
          return;
        }
        
        navigator.clipboard.writeText(text).then(() => {
          const originalText = copyBtn.textContent;
          copyBtn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
          setTimeout(() => {
            copyBtn.textContent = originalText;
          }, 2000);
          showNotification('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
        });
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      updateVisuals();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
    function initSmallTools() {
      smallTools.forEach(tool => {
        tool.addEventListener('click', () => {
          const toolType = tool.dataset.quick;
          
          // –ï—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ –Ω–∞ —É–∂–µ –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç - –æ—Ç–∫–ª—é—á–∞–µ–º –µ–≥–æ
          if (currentQuickTool === toolType) {
            currentQuickTool = null;
            tool.classList.remove('active');
            // –í–∫–ª—é—á–∞–µ–º —Å–≤–æ–±–æ–¥–Ω—É—é —Ä–∞–∑–º–µ—Ç–∫—É –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
            setMode('free');
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é (—É–±–∏—Ä–∞–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ)
            updateVisuals();
          } else {
            // –í–∫–ª—é—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
            currentQuickTool = toolType;
            smallTools.forEach(t => t.classList.remove('active'));
            tool.classList.add('active');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º free (–¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è)
            setMode('free');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            updateVisuals();
          }
        });
      });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    function createEditorStrip() {
      editorStripEl.innerHTML = '';
      
      ROWS.forEach((row, rowIndex) => {
        const rowEl = document.createElement('div');
        rowEl.className = 'row';
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
        const isReversed = rowIndex % 2 === 1; // –ù–µ—á–µ—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–¥—É—Ç —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ
        
        // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
        let indices = [];
        for (let i = row.start; i < row.start + row.count; i++) {
          indices.push(i);
        }
        
        // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –æ–±—Ä–∞—Ç–Ω–∞—è, –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–æ—Ä—è–¥–æ–∫
        if (isReversed) {
          indices.reverse();
        }
        
        // –°–æ–∑–¥–∞–µ–º —Å–≤–µ—Ç–æ–¥–∏–æ–¥—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
        indices.forEach(index => {
          const led = document.createElement('div');
          led.className = 'led';
          led.id = `editor-led-${index}`;
          
          // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –Ω–æ–º–µ—Ä–∞ –Ω–æ—Ä—ã
          const numberEl = document.createElement('div');
          numberEl.className = 'led-hole-number';
          led.appendChild(numberEl);
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –∏ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø–æ–∑–∏—Ü–∏–π
          if (index === 0) led.classList.add('start');
          if (index === finishPos) led.classList.add('finish');
          
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
          led.addEventListener('click', () => handleLedClick(index));
          
          rowEl.appendChild(led);
        });
        
        editorStripEl.appendChild(rowEl);
      });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    function updateVisuals() {
      for (let i = 0; i < NUM_LEDS; i++) {
        const led = document.getElementById(`editor-led-${i}`);
        if (!led) continue;
        
        const numberEl = led.querySelector('.led-hole-number');
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–ª–∞—Å—Å—ã –∏ —Å—Ç–∏–ª–∏
        led.classList.remove('start', 'finish', 'bag', 'path', 'hole', 'editing');
        led.style.borderColor = 'transparent';
        led.style.backgroundColor = '';
        led.style.opacity = '1';
        if (numberEl) {
          numberEl.textContent = '';
          numberEl.style.color = '#fff';
        }
        
        // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω —Ä–µ–∂–∏–º –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞, –∑–∞—Ç–µ–º–Ω—è–µ–º –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
        if (currentQuickTool === 'path') {
          // –í —Ä–µ–∂–∏–º–µ —Ç—Ä–æ–ø–∏–Ω–∫–∏ –∑–∞—Ç–µ–º–Ω—è–µ–º –≤—Å–µ, –∫—Ä–æ–º–µ —Ç—Ä–æ–ø–∏–Ω–æ–∫, —Å—Ç–∞—Ä—Ç–∞ –∏ —Ñ–∏–Ω–∏—à–∞
          if (networks[i] !== ELEMENT_TYPES.PATH && i !== 0 && i !== finishPos) {
            led.style.opacity = '0.3';
          }
        } else if (currentQuickTool === 'bag') {
          // –í —Ä–µ–∂–∏–º–µ –º–µ—à–∫–æ–≤ –∑–∞—Ç–µ–º–Ω—è–µ–º –≤—Å–µ, –∫—Ä–æ–º–µ –º–µ—à–∫–æ–≤, —Å—Ç–∞—Ä—Ç–∞ –∏ —Ñ–∏–Ω–∏—à–∞
          if (networks[i] !== ELEMENT_TYPES.BAG && i !== 0 && i !== finishPos) {
            led.style.opacity = '0.3';
          }
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
        if (i === 0) {
          led.classList.add('start');
          led.style.backgroundColor = 'blue';
        } else if (i === finishPos) {
          led.classList.add('finish');
          led.style.backgroundColor = 'red';
        } else if (networks[i] === ELEMENT_TYPES.BAG) {
          led.classList.add('bag');
          led.style.backgroundColor = 'orange';
        } else if (networks[i] === ELEMENT_TYPES.PATH) {
          led.classList.add('path');
          led.style.backgroundColor = 'yellow';
          numberEl.style.color = '#111';
        } else if (networks[i] < 180) { // –≠—Ç–æ –Ω–æ—Ä–∞
          led.classList.add('hole');
          led.style.backgroundColor = '#222';
          
          // –ù–∞—Ö–æ–¥–∏–º —Å–µ—Ç—å, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–æ—Ä–∞
          let foundNetwork = null;
          let holeIndex = -1;
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ç–∏
          for (let n = 0; n < holeNetworks.length; n++) {
            const network = holeNetworks[n];
            const index = network.indexOf(i);
            if (index !== -1) {
              foundNetwork = n;
              holeIndex = index;
              break;
            }
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é —Å–æ–∑–¥–∞–≤–∞–µ–º—É—é —Å–µ—Ç—å
          if (foundNetwork === null && currentMode === 'hole') {
            const index = holeNetwork.indexOf(i);
            if (index !== -1) {
              foundNetwork = holeNetworks.length; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Ç–∏
              holeIndex = index;
            }
          }
          
          // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Å–µ—Ç—å, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–≤–æ–¥–∫—É
          if (foundNetwork !== null) {
            const color = getNetworkColor(foundNetwork);
            led.style.borderColor = color;
            led.style.borderWidth = '2px';
            led.style.borderStyle = 'solid';
          }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
        if (showAllIndices) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –í–°–ï–• –∫–ª–µ—Ç–∫–∞—Ö
          if (numberEl) {
            numberEl.textContent = i;
            // –í—ã–±–∏—Ä–∞–µ–º —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–ª–µ—Ç–∫–∏
            if (i === 0) {
              numberEl.style.color = 'white';
            } else if (i === finishPos) {
              numberEl.style.color = 'white';
            } else if (networks[i] === ELEMENT_TYPES.BAG) {
              numberEl.style.color = 'white';
            } else if (networks[i] === ELEMENT_TYPES.PATH) {
              numberEl.style.color = '#111';
            } else if (networks[i] < 180) { // –ù–æ—Ä–∞
              numberEl.style.color = '#fff';
            } else {
              numberEl.style.color = '#888';
            }
          }
        } else if (showHoleIndices && networks[i] < 180) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–æ—Ä–∞—Ö
          if (numberEl) {
            numberEl.textContent = i;
            numberEl.style.color = '#fff';
          }
        } else if (networks[i] < 180) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–º–µ—Ä –≤ —Å–µ—Ç–∏ –¥–ª—è –Ω–æ—Ä
          if (numberEl) {
            // –ù–∞—Ö–æ–¥–∏–º —Å–µ—Ç—å, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–æ—Ä–∞
            let foundNetwork = null;
            let holeIndex = -1;
            
            for (let n = 0; n < holeNetworks.length; n++) {
              const network = holeNetworks[n];
              const index = network.indexOf(i);
              if (index !== -1) {
                foundNetwork = n;
                holeIndex = index;
                break;
              }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é —Å–æ–∑–¥–∞–≤–∞–µ–º—É—é —Å–µ—Ç—å
            if (foundNetwork === null && currentMode === 'hole') {
              const index = holeNetwork.indexOf(i);
              if (index !== -1) {
                foundNetwork = holeNetworks.length;
                holeIndex = index;
              }
            }
            
            if (holeIndex !== -1) {
              numberEl.textContent = holeIndex + 1;
              numberEl.style.color = '#fff';
            }
          }
        }
        
        // –í—ã–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ç–∏
        if (currentMode === 'hole' && holeNetwork.includes(i)) {
          led.classList.add('editing');
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –≤ —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–π —Å–µ—Ç–∏
          const index = holeNetwork.indexOf(i);
          if (index !== -1 && numberEl) {
            if (showAllIndices) {
              numberEl.textContent = i;
              numberEl.style.color = NETWORK_COLORS[holeNetworks.length % NETWORK_COLORS.length];
            } else if (showHoleIndices) {
              numberEl.textContent = i;
              numberEl.style.color = NETWORK_COLORS[holeNetworks.length % NETWORK_COLORS.length];
            } else {
              numberEl.textContent = index + 1;
              numberEl.style.color = NETWORK_COLORS[holeNetworks.length % NETWORK_COLORS.length];
            }
          }
        }
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–µ—Ç–µ–π
      updateNetworksList();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Ç–µ–π
    function updateNetworksList() {
      if (holeNetworks.length === 0) {
        networksList.style.display = 'none';
        return;
      }
      
      networksList.style.display = 'block';
      networksListContent.innerHTML = '';
      
      holeNetworks.forEach((network, index) => {
        const networkItem = document.createElement('div');
        networkItem.className = 'network-item';
        networkItem.innerHTML = `
          <div class="network-color" style="border-color: ${getNetworkColor(index)}; background: ${getNetworkColor(index)}20;"></div>
          <div class="network-info">–°–µ—Ç—å ${index + 1}: ${network.length} –Ω–æ—Ä(—ã), –ø–æ–∑–∏—Ü–∏–∏: ${network.join(', ')}</div>
        `;
        networksListContent.appendChild(networkItem);
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Å–≤–µ—Ç–æ–¥–∏–æ–¥—É –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    function handleLedClick(pos) {
      if (pos === 0 && currentMode !== 'info' && currentMode !== 'select-finish') return; // –°—Ç–∞—Ä—Ç –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
      if (currentQuickTool === 'path') {
        // –†–µ–∂–∏–º —Ç–æ–ª—å–∫–æ —Ç—Ä–æ–ø–∏–Ω–∫–∏
        if (pos !== 0 && pos !== finishPos) {
          // –£–¥–∞–ª—è–µ–º –Ω–æ—Ä—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
          if (networks[pos] < 180) {
            removeHoleFromNetworks(pos);
          }
          
          // –£–¥–∞–ª—è–µ–º –º–µ—à–æ–∫, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
          if (networks[pos] === ELEMENT_TYPES.BAG) {
            networks[pos] = ELEMENT_TYPES.EMPTY;
          }
          
          // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç—Ä–æ–ø–∏–Ω–∫—É
          if (networks[pos] === ELEMENT_TYPES.PATH) {
            networks[pos] = ELEMENT_TYPES.EMPTY;
          } else {
            networks[pos] = ELEMENT_TYPES.PATH;
          }
        }
      } else if (currentQuickTool === 'bag') {
        // –†–µ–∂–∏–º —Ç–æ–ª—å–∫–æ –º–µ—à–∫–∏
        if (pos !== 0 && pos !== finishPos) {
          // –£–¥–∞–ª—è–µ–º –Ω–æ—Ä—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
          if (networks[pos] < 180) {
            removeHoleFromNetworks(pos);
          }
          
          // –£–¥–∞–ª—è–µ–º —Ç—Ä–æ–ø–∏–Ω–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
          if (networks[pos] === ELEMENT_TYPES.PATH) {
            networks[pos] = ELEMENT_TYPES.EMPTY;
          }
          
          // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –º–µ—à–æ–∫
          if (networks[pos] === ELEMENT_TYPES.BAG) {
            networks[pos] = ELEMENT_TYPES.EMPTY;
          } else {
            networks[pos] = ELEMENT_TYPES.BAG;
          }
        }
      } else {
        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞
        switch (currentMode) {
          case 'free':
            cycleElementType(pos);
            break;
          case 'hole':
            addToHoleNetwork(pos);
            break;
          case 'select-finish':
            setFinishPosition(pos);
            break;
          case 'info':
            showLedInfo(pos);
            break;
        }
      }
      
      updateVisuals();
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ (–≤ —Å–≤–æ–±–æ–¥–Ω–æ–º —Ä–µ–∂–∏–º–µ)
    function cycleElementType(pos) {
      // –ï—Å–ª–∏ —ç—Ç–æ —Ñ–∏–Ω–∏—à, —Å–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–∏–Ω–∏—à
      if (pos === finishPos) {
        networks[pos] = ELEMENT_TYPES.EMPTY;
        finishPos = -1;
      }
      
      // –ï—Å–ª–∏ —ç—Ç–æ –Ω–æ—Ä–∞, —É–¥–∞–ª—è–µ–º –∏–∑ –≤—Å–µ—Ö —Å–µ—Ç–µ–π
      if (networks[pos] < 180) {
        removeHoleFromNetworks(pos);
      }
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–∏–ø—ã
      switch (networks[pos]) {
        case ELEMENT_TYPES.EMPTY:
          networks[pos] = ELEMENT_TYPES.BAG;
          break;
        case ELEMENT_TYPES.BAG:
          networks[pos] = ELEMENT_TYPES.PATH;
          break;
        case ELEMENT_TYPES.PATH:
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∫ —Ñ–∏–Ω–∏—à, –µ—Å–ª–∏ —Ñ–∏–Ω–∏—à –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
          if (finishPos === -1) {
            networks[pos] = ELEMENT_TYPES.FINISH;
            finishPos = pos;
          } else {
            networks[pos] = ELEMENT_TYPES.EMPTY;
          }
          break;
        default:
          networks[pos] = ELEMENT_TYPES.EMPTY;
      }
    }

    // –£–¥–∞–ª–∏—Ç—å –Ω–æ—Ä—É –∏–∑ –≤—Å–µ—Ö —Å–µ—Ç–µ–π
    function removeHoleFromNetworks(pos) {
      // –£–¥–∞–ª—è–µ–º –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π
      for (let i = 0; i < holeNetworks.length; i++) {
        const index = holeNetworks[i].indexOf(pos);
        if (index !== -1) {
          holeNetworks[i].splice(index, 1);
          
          // –ï—Å–ª–∏ —Å–µ—Ç—å —Å—Ç–∞–ª–∞ –ø—É—Å—Ç–æ–π, —É–¥–∞–ª—è–µ–º –µ—ë
          if (holeNetworks[i].length < 2) {
            holeNetworks.splice(i, 1);
            i--;
          }
        }
      }
      
      // –£–¥–∞–ª—è–µ–º –∏–∑ —Ç–µ–∫—É—â–µ–π —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–π —Å–µ—Ç–∏
      const index = holeNetwork.indexOf(pos);
      if (index !== -1) {
        holeNetwork.splice(index, 1);
      }
      
      networks[pos] = ELEMENT_TYPES.EMPTY;
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ —Å–µ—Ç—å –Ω–æ—Ä
    function addToHoleNetwork(pos) {
      // –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ —Ñ–∏–Ω–∏—à –∏–ª–∏ —Å—Ç–∞—Ä—Ç, –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
      if (pos === finishPos || pos === 0) return;
      
      // –ï—Å–ª–∏ —Å–≤–µ—Ç–æ–¥–∏–æ–¥ —É–∂–µ –≤ —Å–µ—Ç–∏, —É–¥–∞–ª—è–µ–º –µ–≥–æ
      const index = holeNetwork.indexOf(pos);
      if (index !== -1) {
        holeNetwork.splice(index, 1);
        networks[pos] = ELEMENT_TYPES.EMPTY;
      } else {
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–µ—Ç—å
        holeNetwork.push(pos);
        networks[pos] = ELEMENT_TYPES.HOLE;
      }
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–∏–Ω–∏—à–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
    function setFinishPosition(pos) {
      // –ù–µ–ª—å–∑—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∏–Ω–∏—à –Ω–∞ —Å—Ç–∞—Ä—Ç
      if (pos === 0) return;
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ñ–∏–Ω–∏—à
      if (finishPos !== -1 && finishPos < NUM_LEDS) {
        networks[finishPos] = ELEMENT_TYPES.EMPTY;
      }
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ñ–∏–Ω–∏—à
      finishPos = pos;
      networks[pos] = ELEMENT_TYPES.FINISH;
      
      // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ä–µ–∂–∏–º —Å–≤–æ–±–æ–¥–Ω–æ–π —Ä–∞–∑–º–µ—Ç–∫–∏
      setMode('free');
      updateToolButtons();
      showNotification('–§–∏–Ω–∏—à —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –ø–æ–∑–∏—Ü–∏—é ' + pos);
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–∞
    function setMode(mode) {
      // –ï—Å–ª–∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ä–µ–∂–∏–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ—Ä –∏ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è —Å–µ—Ç—å
      if (currentMode === 'hole' && mode !== 'hole' && holeNetwork.length > 1) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª–∏–Ω—É –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
        const holeCount = holeNetwork.length;
        saveHoleNetwork();
        showNotification(`–°–æ–∑–¥–∞–Ω–∞ —Å–µ—Ç—å –Ω–æ—Ä –∏–∑ ${holeCount} –æ—Ç–≤–µ—Ä—Å—Ç–∏–π`);
      } else if (currentMode === 'hole' && mode !== 'hole') {
        // –ï—Å–ª–∏ —Å–µ—Ç—å –ø—É—Å—Ç–∞ –∏–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –Ω–æ—Ä–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
        holeNetwork.forEach(pos => {
          networks[pos] = ELEMENT_TYPES.EMPTY;
        });
        holeNetwork = [];
      }
      
      // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å —Ä–µ–∂–∏–º–∞ info
      if (currentMode === 'info' && mode !== 'info') {
        infoPanel.style.display = 'none';
      }
      
      currentMode = mode;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º sub-toolbar
      const subToolbar = document.querySelector('.sub-toolbar');
      const freeToolBtn = document.getElementById('freeToolBtn');
      
      if (subToolbar && freeToolBtn) {
        if (mode === 'free') {
          subToolbar.style.display = 'flex';
          freeToolBtn.classList.add('active');
        } else {
          subToolbar.style.display = 'none';
          freeToolBtn.classList.remove('active');
          // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –º–∞–ª–µ–Ω—å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞
          currentQuickTool = null;
          smallTools.forEach(t => t.classList.remove('active'));
        }
      }
      
      updateToolButtons();
      updateVisuals();
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Ç–∏ –Ω–æ—Ä
    function saveHoleNetwork() {
      if (holeNetwork.length < 2) return;
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ç—å –≤ –º–∞—Å—Å–∏–≤ —Å–µ—Ç–µ–π
      holeNetworks.push([...holeNetwork]);
      
      // –°–æ–∑–¥–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é —Å–µ—Ç—å –≤ –º–∞—Å—Å–∏–≤–µ networks
      for (let i = 0; i < holeNetwork.length; i++) {
        const current = holeNetwork[i];
        const next = holeNetwork[(i + 1) % holeNetwork.length];
        networks[current] = next;
      }
      
      // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â—É—é —Å–µ—Ç—å
      holeNetwork = [];
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ä–µ–∂–∏–º–æ–≤
    function updateToolButtons() {
      toolButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.mode === currentMode) {
          btn.classList.add('active');
        }
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤ –≤—Å–µ—Ö –∫–ª–µ—Ç–æ–∫
    function toggleAllIndices() {
      showAllIndices = showAllIndicesCheckbox.checked;
      // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø–æ–∫–∞–∑ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, –æ—Ç–∫–ª—é—á–∞–µ–º –ø–æ–∫–∞–∑ —Ç–æ–ª—å–∫–æ –Ω–æ—Ä
      if (showAllIndices) {
        showHoleIndices = false;
        showHoleIndicesCheckbox.checked = false;
      }
      updateVisuals();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–æ—Ä
    function toggleHoleIndices() {
      showHoleIndices = showHoleIndicesCheckbox.checked;
      // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –ø–æ–∫–∞–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–æ—Ä –∏ –ø—Ä–∏ —ç—Ç–æ–º –≤–∫–ª—é—á–µ–Ω –ø–æ–∫–∞–∑ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤, –æ—Ç–∫–ª—é—á–∞–µ–º –ø–æ–∫–∞–∑ –≤—Å–µ—Ö
      if (showHoleIndices && showAllIndices) {
        showAllIndices = false;
        showAllIndicesCheckbox.checked = false;
      }
      updateVisuals();
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
    function clearField() {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ? –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.')) {
        return;
      }
      
      networks = new Array(NUM_LEDS).fill(ELEMENT_TYPES.EMPTY);
      networks[0] = ELEMENT_TYPES.START;
      finishPos = 179;
      networks[finishPos] = ELEMENT_TYPES.FINISH;
      holeNetwork = [];
      holeNetworks = [];
      currentQuickTool = null;
      smallTools.forEach(t => t.classList.remove('active'));
      infoPanel.style.display = 'none';
      updateVisuals();
      showNotification('–ü–æ–ª–µ –æ—á–∏—â–µ–Ω–æ');
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –Ω–æ—Ä–µ (—Å–≤—è–∑–∫–∞ 1-2-3)
    function updateHoleInfo(pos) {
      if (networks[pos] < 180 && networks[pos] >= 0) {
        // –ù–∞—Ö–æ–¥–∏–º —Å–µ—Ç—å, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–æ—Ä–∞
        let network = [];
        let visited = new Set();
        let current = pos;
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–æ—Ä—ã –≤ —Å–µ—Ç–∏
        while (!visited.has(current)) {
          visited.add(current);
          network.push(current);
          current = networks[current];
        }
        
        // –ï—Å–ª–∏ –Ω–∞—à–ª–∏ —Å–µ—Ç—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ—Ä
        if (network.length > 1) {
          // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É –≤ —Å–µ—Ç–∏
          let orderedNetwork = [];
          current = pos;
          
          // –ù–∞—Ö–æ–¥–∏–º –Ω–∞—á–∞–ª–æ —Å–µ—Ç–∏
          while (true) {
            let found = false;
            for (let i = 0; i < NUM_LEDS; i++) {
              if (networks[i] === current && !orderedNetwork.includes(i)) {
                current = i;
                found = true;
                break;
              }
            }
            if (!found) break;
          }
          
          // –°–æ–±–∏—Ä–∞–µ–º –≤ –ø–æ—Ä—è–¥–∫–µ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
          orderedNetwork = [current];
          while (networks[current] !== orderedNetwork[0]) {
            current = networks[current];
            orderedNetwork.push(current);
          }
          
          // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–π –Ω–æ—Ä—ã
          const index = orderedNetwork.indexOf(pos);
          
          // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å–≤—è–∑–∫–∏
          let chain = [];
          for (let i = 0; i < orderedNetwork.length; i++) {
            chain.push((i + 1).toString());
          }
          
          return `–°–µ—Ç—å –Ω–æ—Ä: [${orderedNetwork.join(', ')}]<br>–°–≤—è–∑–∫–∞: ${chain.join('-')}<br>–¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è –≤ —Å–µ—Ç–∏: ${index + 1}`;
        }
      }
      return null;
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–µ—Ç–æ–¥–∏–æ–¥–µ
    function showLedInfo(pos) {
      infoPanel.style.display = 'block';
      
      let html = '';
      html += `<div><strong>–ü–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä:</strong> ${pos}</div>`;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –∏ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Å—Ç—Ä–æ–∫–µ
      let rowIndex = -1;
      let positionInRow = -1;
      let isReversed = false;
      
      for (let i = 0; i < ROWS.length; i++) {
        const row = ROWS[i];
        if (pos >= row.start && pos < row.start + row.count) {
          rowIndex = i;
          positionInRow = pos - row.start;
          isReversed = i % 2 === 1; // –ù–µ—á–µ—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –æ–±—Ä–∞—Ç–Ω—ã–µ
          break;
        }
      }
      
      if (rowIndex !== -1) {
        html += `<div><strong>–°—Ç—Ä–æ–∫–∞:</strong> ${rowIndex + 1} (${isReversed ? '—Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ' : '—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ'})</div>`;
        html += `<div><strong>–ü–æ–∑–∏—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫–µ:</strong> ${positionInRow + 1}</div>`;
      }
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —ç–ª–µ–º–µ–Ω—Ç–∞
      if (pos === 0) {
        html += `<div><strong>–¢–∏–ø:</strong> –°—Ç–∞—Ä—Ç (–Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –º—ã—à–∏)</div>`;
      } else if (pos === finishPos) {
        html += `<div><strong>–¢–∏–ø:</strong> –§–∏–Ω–∏—à (—Ü–µ–ª—å –º—ã—à–∏)</div>`;
      } else if (networks[pos] === ELEMENT_TYPES.BAG) {
        html += `<div><strong>–¢–∏–ø:</strong> –ú–µ—à–æ–∫</div>`;
      } else if (networks[pos] === ELEMENT_TYPES.PATH) {
        html += `<div><strong>–¢–∏–ø:</strong> –¢—Ä–æ–ø–∏–Ω–∫–∞ (–º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è)</div>`;
      } else if (networks[pos] < 180) { // –≠—Ç–æ –Ω–æ—Ä–∞
        html += `<div><strong>–¢–∏–ø:</strong> –ù–æ—Ä–∞ (—Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º—ã—à—å)</div>`;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤—è–∑–∫—É –¥–ª—è –Ω–æ—Ä—ã
        const holeInfo = updateHoleInfo(pos);
        if (holeInfo) {
          html += `<div style="margin: 10px 0; padding: 10px; background: #222; border-radius: 6px;">`;
          html += holeInfo;
          html += `</div>`;
        }
        
        // –ù–∞—Ö–æ–¥–∏–º —Å–µ—Ç—å, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –Ω–æ—Ä–∞
        let foundNetwork = null;
        let holeIndex = -1;
        
        for (let n = 0; n < holeNetworks.length; n++) {
          const network = holeNetworks[n];
          const index = network.indexOf(pos);
          if (index !== -1) {
            foundNetwork = n;
            holeIndex = index;
            break;
          }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é —Å–æ–∑–¥–∞–≤–∞–µ–º—É—é —Å–µ—Ç—å
        if (foundNetwork === null && currentMode === 'hole') {
          const index = holeNetwork.indexOf(pos);
          if (index !== -1) {
            foundNetwork = holeNetworks.length; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Ç–∏
            holeIndex = index;
          }
        }
        
        if (foundNetwork !== null) {
          const color = getNetworkColor(foundNetwork);
          html += `<div><strong>–°–µ—Ç—å –Ω–æ—Ä:</strong> ‚Ññ${foundNetwork + 1}</div>`;
          html += `<div><strong>–ù–æ–º–µ—Ä –≤ —Å–µ—Ç–∏:</strong> ${holeIndex + 1}</div>`;
          html += `<div><strong>–¶–≤–µ—Ç —Å–µ—Ç–∏:</strong> <span style="color:${color}">${color}</span></div>`;
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤—è–∑—å
          if (foundNetwork < holeNetworks.length) {
            const network = holeNetworks[foundNetwork];
            const nextIndex = (holeIndex + 1) % network.length;
            const nextPos = network[nextIndex];
            html += `<div><strong>–°–≤—è–∑–∞–Ω–∞ —Å:</strong> –∫–ª–µ—Ç–∫–∞ ‚Ññ${nextPos}</div>`;
          }
        }
      } else {
        html += `<div><strong>–¢–∏–ø:</strong> –ü—É—Å—Ç–æ (–æ–±—ã—á–Ω–∞—è –∫–ª–µ—Ç–∫–∞, –ø–æ –Ω–µ–π –Ω–µ–ª—å–∑—è —Ö–æ–¥–∏—Ç—å)</div>`;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–µ networks
      html += `<div><strong>–ó–Ω–∞—á–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–µ:</strong> networks[${pos}] = ${networks[pos]}</div>`;
      
      infoDetails.innerHTML = html;
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞ —É—Ä–æ–≤–Ω—è
    function generateLevelCode() {
      const levelNum = document.getElementById('levelNum').value;
      const levelName = document.getElementById('levelName').value;
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
      if (!levelNum) {
        return '// –û—à–∏–±–∫–∞: –£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è';
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º –∫–æ–¥ —É—Ä–æ–≤–Ω—è
      let code = `else if (level == ${levelNum}) {  // ${levelName}\n`;
      code += `    L_FINISH = ${finishPos};\n`;
      code += `    networks[0] = 181;\n`;
      code += `    networks[${finishPos}] = 182;\n`;
      code += `    currPos = 0;\n\n`;

      // –°–µ—Ç–∏ –Ω–æ—Ä
      if (holeNetworks.length > 0) {
        code += `    // –°–µ—Ç–∏ –Ω–æ—Ä\n`;
        
        holeNetworks.forEach((network, networkIndex) => {
          code += `    // –°–µ—Ç—å –Ω–æ—Ä ${networkIndex + 1}\n`;
          for (let i = 0; i < network.length; i++) {
            const current = network[i];
            const next = network[(i + 1) % network.length];
            code += `    networks[${current}] = ${next};\n`;
          }
          code += `\n`;
        });
      }

      // –ú–µ—à–∫–∏
      const bags = [];
      for (let i = 1; i < NUM_LEDS; i++) {
        if (networks[i] === ELEMENT_TYPES.BAG) {
          bags.push(i);
        }
      }
      
      if (bags.length > 0) {
        code += `    // –ú–µ—à–∫–∏\n`;
        bags.forEach(bag => {
          code += `    networks[${bag}] = 183;\n`;
        });
        code += `\n`;
      }

      // –¢—Ä–æ–ø–∏–Ω–∫–∏
      const paths = [];
      let currentPath = [];
      
      for (let i = 1; i < NUM_LEDS; i++) {
        if (networks[i] === ELEMENT_TYPES.PATH) {
          if (currentPath.length === 0 || i === currentPath[currentPath.length - 1] + 1) {
            currentPath.push(i);
          } else {
            paths.push([...currentPath]);
            currentPath = [i];
          }
        } else if (currentPath.length > 0) {
          paths.push([...currentPath]);
          currentPath = [];
        }
      }
      
      if (currentPath.length > 0) {
        paths.push(currentPath);
      }
      
      if (paths.length > 0) {
        code += `    // –¢—Ä–æ–ø–∏–Ω–∫–∏\n`;
        paths.forEach((path, index) => {
          const pathNum = index + 1;
          if (path.length === 1) {
            code += `    networks[${path[0]}] = 185;  // –¢—Ä–æ–ø–∏–Ω–∫–∞ ${pathNum}\n`;
          } else {
            code += `    for (int i = ${path[0]}; i <= ${path[path.length - 1]}; i++) networks[i] = 185;  // –¢—Ä–æ–ø–∏–Ω–∫–∞ ${pathNum}\n`;
          }
        });
      }

      code += `  }`;
      return code;
    }

    // =============================================
    // –≠–ú–£–õ–Ø–¢–û–† –ò–ì–†–´
    // =============================================

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —ç–º—É–ª—è—Ç–æ—Ä–∞
    let emulatorNetworks = new Array(NUM_LEDS).fill(180);
    let emulatorCurrPos = 0;
    let emulatorGameWon = false;
    let emulatorL_FINISH = 0;
    let currentEmulatorLevel = 1;
    let isEmulatorCustomLevel = false;

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–∞
    const emulatorStripEl = document.getElementById('emulatorStrip');
    const emulatorStatus = document.getElementById('emulatorStatus');
    const emulatorLevelSelect = document.getElementById('emulatorLevel');
    const customLevelSection = document.getElementById('customLevelSection');
    const emulatorCustomCode = document.getElementById('emulatorCustomCode');
    const loadEmulatorLevelBtn = document.getElementById('loadEmulatorLevel');
    const emulatorResetBtn = document.getElementById('emulatorReset');
    const emulatorSolutionBtn = document.getElementById('emulatorSolution');
    const emulatorSolutionContainer = document.getElementById('emulatorSolutionContainer');
    const emulatorSolutionSteps = document.getElementById('emulatorSolutionSteps');
    const emulatorLeftBtn = document.getElementById('emulatorLeft');
    const emulatorCenterBtn = document.getElementById('emulatorCenter');
    const emulatorRightBtn = document.getElementById('emulatorRight');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–º—É–ª—è—Ç–æ—Ä–∞
    function initEmulator() {
      // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–∞
      createEmulatorStrip();
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è 1
      loadStandardLevel(1);
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      emulatorLevelSelect.addEventListener('change', function() {
        if (this.value === 'custom') {
          customLevelSection.style.display = 'block';
        } else {
          customLevelSection.style.display = 'none';
          loadStandardLevel(parseInt(this.value));
        }
      });
      
      loadEmulatorLevelBtn.addEventListener('click', loadCustomLevelToEmulator);
      emulatorResetBtn.addEventListener('click', resetEmulator);
      emulatorSolutionBtn.addEventListener('click', showEmulatorSolution);
      emulatorLeftBtn.addEventListener('click', moveEmulatorLeft);
      emulatorCenterBtn.addEventListener('click', moveEmulatorToHole);
      emulatorRightBtn.addEventListener('click', moveEmulatorRight);
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã —ç–º—É–ª—è—Ç–æ—Ä–∞
    function createEmulatorStrip() {
      emulatorStripEl.innerHTML = '';
      
      ROWS.forEach(row => {
        const rowEl = document.createElement('div');
        rowEl.className = 'row';
        for (let i = row.start; i < row.start + row.count; i++) {
          const led = document.createElement('div');
          led.className = 'led';
          led.id = `emulator-led-${i}`;
          rowEl.appendChild(led);
        }
        emulatorStripEl.appendChild(rowEl);
      });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–º—É–ª—è—Ç–æ—Ä–∞
    function updateEmulatorDisplay() {
      for (let i = 0; i < NUM_LEDS; i++) {
        const led = document.getElementById(`emulator-led-${i}`);
        if (!led) continue;

        let color = '#222';
        if (emulatorNetworks[i] === 180) color = '#222'; // –ü—É—Å—Ç–æ
        else if (emulatorNetworks[i] === 181) color = 'blue'; // –°—Ç–∞—Ä—Ç
        else if (emulatorNetworks[i] === 182) color = 'red'; // –§–∏–Ω–∏—à
        else if (emulatorNetworks[i] === 183) color = 'orange'; // –ú–µ—à–∫–∏
        else if (emulatorNetworks[i] === 185) color = 'yellow'; // –¢—Ä–æ–ø–∏–Ω–∫–∏
        else if (emulatorNetworks[i] < 180) color = 'green'; // –ù–æ—Ä—ã

        led.style.backgroundColor = color;
      }

      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏
      const currLed = document.getElementById(`emulator-led-${emulatorCurrPos}`);
      if (currLed) {
        currLed.style.backgroundColor = 'white';
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
    function loadStandardLevel(level) {
      emulatorNetworks.fill(180);
      currentEmulatorLevel = level;
      isEmulatorCustomLevel = false;
      
      if (level === 1) {
        emulatorL_FINISH = 36;
        emulatorNetworks[0] = 181;
        emulatorNetworks[35] = 182;
        emulatorCurrPos = 0;

        emulatorNetworks[1] = 12; emulatorNetworks[12] = 23; emulatorNetworks[23] = 1;
        emulatorNetworks[2] = 17; emulatorNetworks[17] = 29; emulatorNetworks[29] = 7; emulatorNetworks[7] = 2;
        emulatorNetworks[6] = 19; emulatorNetworks[19] = 32; emulatorNetworks[32] = 33; emulatorNetworks[33] = 6;
        emulatorNetworks[5] = 15; emulatorNetworks[15] = 5;
        emulatorNetworks[14] = 35; emulatorNetworks[35] = 14;
        emulatorNetworks[36] = 182;
      } else if (level === 2) {
        emulatorL_FINISH = 179;
        emulatorNetworks[0] = 181;
        emulatorNetworks[179] = 182;
        emulatorCurrPos = 0;

        emulatorNetworks[1] = 46; emulatorNetworks[46] = 175; emulatorNetworks[175] = 100; emulatorNetworks[100] = 137; emulatorNetworks[137] = 1;
        emulatorNetworks[11] = 88; emulatorNetworks[88] = 148; emulatorNetworks[148] = 54; emulatorNetworks[54] = 169; emulatorNetworks[169] = 11;
        emulatorNetworks[21] = 43; emulatorNetworks[43] = 170; emulatorNetworks[170] = 95; emulatorNetworks[95] = 130; emulatorNetworks[130] = 21;
        emulatorNetworks[23] = 157; emulatorNetworks[157] = 144; emulatorNetworks[144] = 113; emulatorNetworks[113] = 75; emulatorNetworks[75] = 23;
        emulatorNetworks[35] = 80; emulatorNetworks[80] = 62; emulatorNetworks[62] = 122; emulatorNetworks[122] = 178; emulatorNetworks[178] = 35;
        emulatorNetworks[179] = 182;

        const bags = [176,163,116,134,141,107,84,39,50,58,71,6,22,29];
        bags.forEach(i => emulatorNetworks[i] = 183);

        for (let i = 12; i <= 20; i++) emulatorNetworks[i] = 185;
        emulatorNetworks[44] = 185; emulatorNetworks[45] = 185;
        for (let i = 89; i <= 94; i++) emulatorNetworks[i] = 185;
        for (let i = 96; i <= 99; i++) emulatorNetworks[i] = 185;
        for (let i = 145; i <= 147; i++) emulatorNetworks[i] = 185;
        for (let i = 123; i <= 129; i++) emulatorNetworks[i] = 185;
        for (let i = 171; i <= 174; i++) emulatorNetworks[i] = 185;
      } else if (level === 3) {
        emulatorL_FINISH = 179;
        emulatorNetworks[0] = 181;
        emulatorNetworks[179] = 182;
        emulatorCurrPos = 0;

        emulatorNetworks[1] = 53; emulatorNetworks[53] = 169; emulatorNetworks[169] = 40; emulatorNetworks[40] = 69; emulatorNetworks[69] = 100; emulatorNetworks[100] = 102; emulatorNetworks[102] = 1;
        emulatorNetworks[8] = 9; emulatorNetworks[9] = 174; emulatorNetworks[174] = 131; emulatorNetworks[131] = 68; emulatorNetworks[68] = 70; emulatorNetworks[70] = 8;
        emulatorNetworks[10] = 131; emulatorNetworks[131] = 88; emulatorNetworks[88] = 60; emulatorNetworks[60] = 2; emulatorNetworks[2] = 80; emulatorNetworks[80] = 94; emulatorNetworks[94] = 10;
        emulatorNetworks[18] = 87; emulatorNetworks[87] = 62; emulatorNetworks[62] = 47; emulatorNetworks[47] = 78; emulatorNetworks[78] = 110; emulatorNetworks[110] = 132; emulatorNetworks[132] = 18;
        emulatorNetworks[37] = 155; emulatorNetworks[155] = 101; emulatorNetworks[101] = 118; emulatorNetworks[118] = 124; emulatorNetworks[124] = 147; emulatorNetworks[147] = 143; emulatorNetworks[143] = 37;
        emulatorNetworks[33] = 41; emulatorNetworks[41] = 136; emulatorNetworks[136] = 23; emulatorNetworks[23] = 160; emulatorNetworks[160] = 74; emulatorNetworks[74] = 79; emulatorNetworks[79] = 33;
        emulatorNetworks[144] = 178; emulatorNetworks[179] = 182;

        const bags = [5,14,27,44,55,65,72,84,97,106,115,128,141,149,164,176];
        bags.forEach(i => emulatorNetworks[i] = 183);

        for (let i = 19; i <= 22; i++) emulatorNetworks[i] = 185;
        for (let i = 34; i <= 36; i++) emulatorNetworks[i] = 185;
        for (let i = 48; i <= 52; i++) emulatorNetworks[i] = 185;
        emulatorNetworks[61] = 185;
        for (let i = 89; i <= 93; i++) emulatorNetworks[i] = 185;
        for (let i = 119; i <= 123; i++) emulatorNetworks[i] = 185;
        for (let i = 133; i <= 135; i++) emulatorNetworks[i] = 185;
        for (let i = 145; i <= 146; i++) emulatorNetworks[i] = 185;
        for (let i = 156; i <= 159; i++) emulatorNetworks[i] = 185;
        for (let i = 170; i <= 173; i++) emulatorNetworks[i] = 185;
      }
      
      emulatorGameWon = false;
      emulatorStatus.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω —É—Ä–æ–≤–µ–Ω—å ${level}`;
      updateEmulatorDisplay();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤ —ç–º—É–ª—è—Ç–æ—Ä
    function loadCustomLevelToEmulator() {
      const code = emulatorCustomCode.value;
      if (!code) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —É—Ä–æ–≤–Ω—è');
        return;
      }
      
      try {
        // –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞ —É—Ä–æ–≤–Ω—è
        const levelData = parseLevelCode(code);
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —ç–º—É–ª—è—Ç–æ—Ä–∞
        emulatorNetworks.fill(180);
        emulatorNetworks[0] = 181;
        emulatorNetworks[levelData.L_FINISH] = 182;
        emulatorL_FINISH = levelData.L_FINISH;
        emulatorCurrPos = 0;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Ç–∏ –Ω–æ—Ä
        for (const [from, to] of levelData.holeConnections) {
          if (from >= 0 && from < NUM_LEDS && to >= 0 && to < NUM_LEDS) {
            emulatorNetworks[from] = to;
          }
        }
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–µ—à–∫–∏
        levelData.bags.forEach(bag => {
          if (bag >= 0 && bag < NUM_LEDS) {
            emulatorNetworks[bag] = 183;
          }
        });
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç—Ä–æ–ø–∏–Ω–∫–∏
        levelData.paths.forEach(path => {
          for (let i = path.start; i <= path.end; i++) {
            if (i >= 0 && i < NUM_LEDS) {
              emulatorNetworks[i] = 185;
            }
          }
        });
        
        isEmulatorCustomLevel = true;
        emulatorGameWon = false;
        emulatorStatus.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω';
        updateEmulatorDisplay();
        showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —ç–º—É–ª—è—Ç–æ—Ä');
      } catch (error) {
        emulatorStatus.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–≤–Ω—è';
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ –∫–æ–¥–∞ —É—Ä–æ–≤–Ω—è');
      }
    }

    // –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–¥–∞ —É—Ä–æ–≤–Ω—è
    function parseLevelCode(code) {
      const result = {
        levelNumber: null,
        L_FINISH: 179,
        holeConnections: new Map(),
        bags: [],
        paths: []
      };

      // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è
      const levelMatch = code.match(/else\s+if\s+\(level\s*==\s*(\d+)\)/);
      if (levelMatch) {
        result.levelNumber = parseInt(levelMatch[1]);
      }

      // –ò–∑–≤–ª–µ–∫–∞–µ–º L_FINISH
      const finishMatch = code.match(/L_FINISH\s*=\s*(\d+);/);
      if (finishMatch) {
        result.L_FINISH = parseInt(finishMatch[1]);
      }

      // –ò–∑–≤–ª–µ–∫–∞–µ–º –≤—Å–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å–µ—Ç–µ–π –Ω–æ—Ä
      const holeMatches = code.matchAll(/networks\[(\d+)\]\s*=\s*(\d+)\s*;/g);
      for (const match of holeMatches) {
        const from = parseInt(match[1]);
        const to = parseInt(match[2]);
        
        // –ò—Å–∫–ª—é—á–∞–µ–º —Å—Ç–∞—Ä—Ç –∏ —Ñ–∏–Ω–∏—à
        if (from !== 0 && to !== 0 && from !== result.L_FINISH && to !== result.L_FINISH) {
          result.holeConnections.set(from, to);
        }
      }

      // –ò–∑–≤–ª–µ–∫–∞–µ–º –º–µ—à–∫–∏
      const bagMatches = code.matchAll(/networks\[(\d+)\]\s*=\s*183\s*;/g);
      for (const match of bagMatches) {
        const pos = parseInt(match[1]);
        result.bags.push(pos);
      }

      // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç—Ä–æ–ø–∏–Ω–∫–∏ (–¥–∏–∞–ø–∞–∑–æ–Ω—ã)
      const pathRangeMatches = code.matchAll(/for\s*\(int\s*i\s*=\s*(\d+)\s*;\s*i\s*<=\s*(\d+)\s*;\s*i\+\+\)\s*networks\[i\]\s*=\s*185\s*;/g);
      for (const match of pathRangeMatches) {
        const start = parseInt(match[1]);
        const end = parseInt(match[2]);
        result.paths.push({ start, end });
      }

      // –ò–∑–≤–ª–µ–∫–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–æ–ø–∏–Ω–∫–∏
      const pathSingleMatches = code.matchAll(/networks\[(\d+)\]\s*=\s*185\s*;/g);
      for (const match of pathSingleMatches) {
        const pos = parseInt(match[1]);
        result.paths.push({ start: pos, end: pos });
      }

      return result;
    }

    // –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏ (—Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª)
    function findSolution(start, target, networksArray) {
      const queue = [{pos: start, path: [], visited: new Set([start])}];
      const maxIterations = 20000;
      let iterations = 0;
      
      while (queue.length > 0 && iterations < maxIterations) {
        iterations++;
        const {pos, path, visited} = queue.shift();
        
        // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ —Ñ–∏–Ω–∏—à–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Ç—å
        if (pos === target) {
          return path;
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ö–æ–¥—ã —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö –ø—Ä–∞–≤–∏–ª
        const moves = [];
        
        // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –≤–ª–µ–≤–æ/–≤–ø—Ä–∞–≤–æ
        const rowLen = (pos < 152) ? 38 : 28;
        const rowStart = pos - (pos % rowLen);
        
        // –í–ª–µ–≤–æ
        const leftPos = pos - 1;
        if (leftPos >= rowStart) {
          const leftVal = networksArray[leftPos];
          // –ú–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–æ–ø–∏–Ω–∫–∞–º, –Ω–æ—Ä–∞–º –∏ —Ñ–∏–Ω–∏—à—É
          // –ù–µ–ª—å–∑—è —Ö–æ–¥–∏—Ç—å –ø–æ –ø—É—Å—Ç—ã–º –∫–ª–µ—Ç–∫–∞–º –∏ –º–µ—à–∫–∞–º
          if (leftVal === 185 || leftVal < 180 || leftVal === 182) {
            moves.push({
              pos: leftPos,
              action: '–í–ª–µ–≤–æ',
              visited: new Set([...visited, leftPos])
            });
          }
        }
        
        // –í–ø—Ä–∞–≤–æ
        const rightPos = pos + 1;
        const rowEnd = rowStart + rowLen;
        if (rightPos < rowEnd) {
          const rightVal = networksArray[rightPos];
          // –ú–æ–∂–Ω–æ —Ö–æ–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ —Ç—Ä–æ–ø–∏–Ω–∫–∞–º, –Ω–æ—Ä–∞–º –∏ —Ñ–∏–Ω–∏—à—É
          // –ù–µ–ª—å–∑—è —Ö–æ–¥–∏—Ç—å –ø–æ –ø—É—Å—Ç—ã–º –∫–ª–µ—Ç–∫–∞–º –∏ –º–µ—à–∫–∞–º
          if (rightVal === 185 || rightVal < 180 || rightVal === 182) {
            moves.push({
              pos: rightPos,
              action: '–í–ø—Ä–∞–≤–æ',
              visited: new Set([...visited, rightPos])
            });
          }
        }
        
        // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∑–∞–Ω—ã—Ä–Ω—É—Ç—å –≤ –Ω–æ—Ä—É
        if (networksArray[pos] < 180) {
          const holePos = networksArray[pos];
          moves.push({
            pos: holePos,
            action: '–ó–∞–Ω—ã—Ä–Ω—É—Ç—å',
            visited: new Set([...visited, holePos])
          });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ö–æ–¥—ã –≤ –æ—á–µ—Ä–µ–¥—å
        for (const move of moves) {
          if (!visited.has(move.pos)) {
            queue.push({
              pos: move.pos,
              path: [...path, move.action],
              visited: move.visited
            });
          }
        }
      }
      
      return null;
    }

    // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û: –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—É–ø–∞—Ç—å –Ω–∞ —Ñ–∏–Ω–∏—à)
    function moveEmulatorLeft() {
      if (emulatorGameWon) return;
      
      const rowLen = (emulatorCurrPos < 152) ? 38 : 28;
      const start = emulatorCurrPos - (emulatorCurrPos % rowLen);
      const nextPos = emulatorCurrPos - 1;
      
      if (nextPos < start) return;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è (–º–æ–∂–Ω–æ –Ω–∞ —Ç—Ä–æ–ø–∏–Ω–∫–∏, –Ω–æ—Ä—ã –∏ —Ñ–∏–Ω–∏—à)
      const nextValue = emulatorNetworks[nextPos];
      if (nextValue === 185 || nextValue < 180 || nextValue === 182) {
        emulatorCurrPos = nextPos;
      }
      
      checkEmulatorWin();
      updateEmulatorDisplay();
    }

    // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û: –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—É–ø–∞—Ç—å –Ω–∞ —Ñ–∏–Ω–∏—à)
    function moveEmulatorRight() {
      if (emulatorGameWon) return;
      
      const rowLen = (emulatorCurrPos < 152) ? 38 : 28;
      const start = emulatorCurrPos - (emulatorCurrPos % rowLen);
      const end = start + rowLen;
      const nextPos = emulatorCurrPos + 1;
      
      if (nextPos >= end) return;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è (–º–æ–∂–Ω–æ –Ω–∞ —Ç—Ä–æ–ø–∏–Ω–∫–∏, –Ω–æ—Ä—ã –∏ —Ñ–∏–Ω–∏—à)
      const nextValue = emulatorNetworks[nextPos];
      if (nextValue === 185 || nextValue < 180 || nextValue === 182) {
        emulatorCurrPos = nextPos;
      }
      
      checkEmulatorWin();
      updateEmulatorDisplay();
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ –Ω–æ—Ä—É –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ
    function moveEmulatorToHole() {
      if (emulatorGameWon) return;
      
      if (emulatorNetworks[emulatorCurrPos] >= 0 && 
          emulatorNetworks[emulatorCurrPos] < 180) {
        emulatorCurrPos = emulatorNetworks[emulatorCurrPos];
      }
      
      checkEmulatorWin();
      updateEmulatorDisplay();
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥—ã –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ (–î–û–ë–ê–í–õ–ï–ù–ê: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ñ–∏–Ω–∏—à–∞)
    function checkEmulatorWin() {
      if (emulatorCurrPos === emulatorL_FINISH) {
        emulatorGameWon = true;
        emulatorStatus.textContent = "üéâ –ü–û–ë–ï–î–ê! –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!";
        showNotification("üéâ –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω! –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!");
      }
    }

    // –°–±—Ä–æ—Å —ç–º—É–ª—è—Ç–æ—Ä–∞
    function resetEmulator() {
      emulatorCurrPos = 0;
      emulatorGameWon = false;
      
      if (isEmulatorCustomLevel) {
        emulatorStatus.textContent = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Å–±—Ä–æ—à–µ–Ω";
      } else {
        emulatorStatus.textContent = `–£—Ä–æ–≤–µ–Ω—å ${currentEmulatorLevel} —Å–±—Ä–æ—à–µ–Ω`;
      }
      
      updateEmulatorDisplay();
    }

    // –ü–æ–∏—Å–∫ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–∞
    function findEmulatorSolution() {
      return findSolution(0, emulatorL_FINISH, emulatorNetworks);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ
    function showEmulatorSolution() {
      const solution = findEmulatorSolution();
      
      if (!solution || solution.length === 0) {
        showNotification('–†–µ—à–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –£—Ä–æ–≤–µ–Ω—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–æ—Ö–æ–¥–∏–º—ã–º.');
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ø–æ–π–ª–µ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        document.getElementById('emulatorSpoiler').classList.add('open');
        emulatorSolutionSteps.innerHTML = '<div style="color: #ff5555; text-align: center; padding: 20px;">–†–µ—à–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –£—Ä–æ–≤–µ–Ω—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–æ—Ö–æ–¥–∏–º—ã–º –∏–ª–∏ –∞–ª–≥–æ—Ä–∏—Ç–º –Ω–µ —Å–º–æ–≥ –Ω–∞–π—Ç–∏ –ø—É—Ç—å.</div>';
        return;
      }
      
      emulatorSolutionSteps.innerHTML = '';
      
      // –î–æ–±–∞–≤–ª—è–µ–º —à–∞–≥–∏ —Ä–µ—à–µ–Ω–∏—è
      solution.forEach((step, index) => {
        const stepEl = document.createElement('div');
        stepEl.className = 'solution-step';
        stepEl.innerHTML = `<span class="step-number">${index + 1}</span> ${step}`;
        emulatorSolutionSteps.appendChild(stepEl);
      });
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–±–µ–¥–µ
      const finalStep = document.createElement('div');
      finalStep.className = 'solution-step';
      finalStep.innerHTML = `<span class="step-number">${solution.length + 1}</span> üéâ –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!`;
      emulatorSolutionSteps.appendChild(finalStep);
      
      // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ø–æ–π–ª–µ—Ä
      document.getElementById('emulatorSpoiler').classList.add('open');
      
      // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ—à–µ–Ω–∏—é
      document.getElementById('emulatorSpoiler').scrollIntoView({ behavior: 'smooth' });
    }

    // =============================================
    // –ì–ï–ù–ï–†–ê–¢–û–† –£–†–û–í–ù–ï–ô
    // =============================================

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
    const generatorStripEl = document.getElementById('generatorStrip');
    const generatorLevelNum = document.getElementById('generatorLevelNum');
    const generatorLevelName = document.getElementById('generatorLevelName');
    const generatorStatus = document.getElementById('generatorStatus');
    const generateBtn = document.getElementById('generateBtn');
    const generatorCopyBtn = document.getElementById('generatorCopyBtn');
    const generatorLoadBtn = document.getElementById('generatorLoadBtn');
    const generatorLoadEmulatorBtn = document.getElementById('generatorLoadEmulatorBtn');
    const generatorCodeOutput = document.getElementById('generatorCodeOutput');
    const generatorSolutionSteps = document.getElementById('generatorSolutionSteps');

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
    let generatedLevelData = null;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
    function initGenerator() {
      // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
      createGeneratorStrip();
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
      generateBtn.addEventListener('click', generateLevel);
      generatorCopyBtn.addEventListener('click', copyGeneratedCode);
      generatorLoadBtn.addEventListener('click', loadGeneratedToEditor);
      generatorLoadEmulatorBtn.addEventListener('click', loadGeneratedToEmulator);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–∑—É–Ω–∫–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
    function initGeneratorSliders() {
      const sliders = [
        { id: 'pathCountSlider', valueId: 'pathCountValue' },
        { id: 'bagCountSlider', valueId: 'bagCountValue' },
        { id: 'holePerNetworkSlider', valueId: 'holePerNetworkValue' },
        { id: 'networkCountSlider', valueId: 'networkCountValue' }
      ];
      
      sliders.forEach(({id, valueId}) => {
        const slider = document.getElementById(id);
        const value = document.getElementById(valueId);
        
        if (slider && value) {
          slider.addEventListener('input', function() {
            value.textContent = this.value;
          });
          
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
          value.textContent = slider.value;
        }
      });
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –ª–µ–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
    function createGeneratorStrip() {
      generatorStripEl.innerHTML = '';
      
      ROWS.forEach(row => {
        const rowEl = document.createElement('div');
        rowEl.className = 'row';
        for (let i = row.start; i < row.start + row.count; i++) {
          const led = document.createElement('div');
          led.className = 'led';
          led.id = `generator-led-${i}`;
          rowEl.appendChild(led);
        }
        generatorStripEl.appendChild(rowEl);
      });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
    function updateGeneratorDisplay() {
      if (!generatedLevelData) return;
      
      for (let i = 0; i < NUM_LEDS; i++) {
        const led = document.getElementById(`generator-led-${i}`);
        if (!led) continue;

        let color = '#222';
        if (generatedLevelData.networks[i] === 180) color = '#222'; // –ü—É—Å—Ç–æ
        else if (generatedLevelData.networks[i] === 181) color = 'blue'; // –°—Ç–∞—Ä—Ç
        else if (generatedLevelData.networks[i] === 182) color = 'red'; // –§–∏–Ω–∏—à
        else if (generatedLevelData.networks[i] === 183) color = 'orange'; // –ú–µ—à–∫–∏
        else if (generatedLevelData.networks[i] === 185) color = 'yellow'; // –¢—Ä–æ–ø–∏–Ω–∫–∏
        else if (generatedLevelData.networks[i] < 180) color = 'green'; // –ù–æ—Ä—ã

        led.style.backgroundColor = color;
      }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è
    function generateLevel() {
      const levelNum = generatorLevelNum.value;
      const levelName = generatorLevelName.value;
      
      if (!levelNum) {
        generatorStatus.textContent = '–û—à–∏–±–∫–∞: –£–∫–∞–∂–∏—Ç–µ –Ω–æ–º–µ—Ä —É—Ä–æ–≤–Ω—è';
        return;
      }
      
      generatorStatus.textContent = '–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è...';
      
      // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
      setTimeout(() => {
        try {
          // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É—Ä–æ–≤–Ω—è
          const level = generateLevelInternal(levelNum, levelName);
          
          // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
          generatedLevelData = level;
          
          // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
          generatorCodeOutput.textContent = level.code;
          displayGeneratorSolution(level.solution);
          updateGeneratorDisplay();
          
          generatorStatus.textContent = `–£—Ä–æ–≤–µ–Ω—å ${levelNum} —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!`;
          showNotification('–£—Ä–æ–≤–µ–Ω—å —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω');
        } catch (error) {
          generatorStatus.textContent = `–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${error.message}`;
        }
      }, 500);
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—É—Ç–∏
    function checkAlternativePath(blockedPos, usedPositions, networks) {
      // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ —Ä—è–¥–æ–º —Å —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–π, —Ç–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –µ—Å—Ç—å
      const neighbors = [blockedPos - 1, blockedPos + 1, blockedPos - 38, blockedPos + 38];
      return neighbors.some(pos => pos >= 0 && pos < NUM_LEDS && usedPositions.has(pos));
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞ –∏–∑ —Å–µ—Ç–µ–π
    function generateLevelCodeFromNetworks(levelNum, levelName, networks, finishPos) {
      let code = `else if (level == ${levelNum}) {  // ${levelName}\n`;
      code += `    L_FINISH = ${finishPos};\n`;
      code += `    networks[0] = 181;\n`;
      code += `    networks[${finishPos}] = 182;\n`;
      code += `    currPos = 0;\n\n`;
      
      // –°–µ—Ç–∏ –Ω–æ—Ä
      const holeConnections = new Map();
      for (let i = 0; i < NUM_LEDS; i++) {
        if (networks[i] < 180 && networks[i] >= 0 && networks[i] !== i) {
          holeConnections.set(i, networks[i]);
        }
      }
      
      if (holeConnections.size > 0) {
        code += `    // –°–µ—Ç–∏ –Ω–æ—Ä\n`;
        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å–µ—Ç—è–º
        const visited = new Set();
        let networkIndex = 1;
        
        for (let [from, to] of holeConnections) {
          if (!visited.has(from)) {
            const network = [];
            let current = from;
            
            while (!visited.has(current)) {
              visited.add(current);
              network.push(current);
              current = networks[current];
            }
            
            if (network.length > 1) {
              code += `    // –°–µ—Ç—å –Ω–æ—Ä ${networkIndex}\n`;
              for (let i = 0; i < network.length; i++) {
                const cur = network[i];
                const nxt = network[(i + 1) % network.length];
                code += `    networks[${cur}] = ${nxt};\n`;
              }
              code += `\n`;
              networkIndex++;
            }
          }
        }
      }
      
      // –ú–µ—à–∫–∏
      const bags = [];
      for (let i = 1; i < NUM_LEDS; i++) {
        if (networks[i] === 183) {
          bags.push(i);
        }
      }
      
      if (bags.length > 0) {
        code += `    // –ú–µ—à–∫–∏\n`;
        bags.forEach(bag => {
          code += `    networks[${bag}] = 183;\n`;
        });
        code += `\n`;
      }
      
      // –¢—Ä–æ–ø–∏–Ω–∫–∏
      const paths = [];
      let currentPath = [];
      
      for (let i = 1; i < NUM_LEDS; i++) {
        if (networks[i] === 185) {
          if (currentPath.length === 0 || i === currentPath[currentPath.length - 1] + 1) {
            currentPath.push(i);
          } else {
            paths.push([...currentPath]);
            currentPath = [i];
          }
        } else if (currentPath.length > 0) {
          paths.push([...currentPath]);
          currentPath = [];
        }
      }
      
      if (currentPath.length > 0) {
        paths.push(currentPath);
      }
      
      if (paths.length > 0) {
        code += `    // –¢—Ä–æ–ø–∏–Ω–∫–∏\n`;
        paths.forEach((path, index) => {
          const pathNum = index + 1;
          if (path.length === 1) {
            code += `    networks[${path[0]}] = 185;  // –¢—Ä–æ–ø–∏–Ω–∫–∞ ${pathNum}\n`;
          } else {
            code += `    for (int i = ${path[0]}; i <= ${path[path.length - 1]}; i++) networks[i] = 185;  // –¢—Ä–æ–ø–∏–Ω–∫–∞ ${pathNum}\n`;
          }
        });
      }
      
      code += `  }`;
      return code;
    }

    // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É—Ä–æ–≤–Ω—è
    function generateLevelInternal(levelNum, levelName) {
      console.log("–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏–º–æ–≥–æ —É—Ä–æ–≤–Ω—è...");
      
      // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –ø–æ–ª–∑—É–Ω–∫–æ–≤
      const params = {
        numPaths: parseInt(document.getElementById('pathCountSlider').value),
        numBags: parseInt(document.getElementById('bagCountSlider').value),
        holesPerNetwork: parseInt(document.getElementById('holePerNetworkSlider').value),
        numNetworks: parseInt(document.getElementById('networkCountSlider').value)
      };
      
      console.log("–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:", params);
      
      const networks = new Array(NUM_LEDS).fill(180);
      const usedPositions = new Set();
      const solutionPath = [];
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—Ç –∏ —Ñ–∏–Ω–∏—à
      networks[0] = 181;
      networks[179] = 182;
      usedPositions.add(0);
      usedPositions.add(179);
      
      // 1. –°–û–ó–î–ê–ï–ú –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –ü–†–û–•–û–î–ò–ú–´–ô –ü–£–¢–¨ –û–¢ –°–¢–ê–†–¢–ê –ö –§–ò–ù–ò–®–£
      console.log("–°–æ–∑–¥–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å –æ—Ç —Å—Ç–∞—Ä—Ç–∞ –∫ —Ñ–∏–Ω–∏—à—É...");
      
      let currentPos = 0;
      const targetPos = 179;
      let stepCount = 0;
      const maxSteps = 30;
      
      // –ü–æ–∫–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–ª–∏ —Ñ–∏–Ω–∏—à–∞ –∏–ª–∏ –Ω–µ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç —à–∞–≥–æ–≤
      while (currentPos !== targetPos && stepCount < maxSteps) {
        stepCount++;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–æ–∫—É
        const row = getRow(currentPos);
        const rowStart = ROWS[row].start;
        const rowEnd = rowStart + ROWS[row].count - 1;
        const direction = (row % 2 === 0) ? 1 : -1; // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏
        
        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
        let nextPos = currentPos;
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –≤ –∫–∞–∫–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–Ω–∏—à
        const targetDirection = (targetPos > currentPos) ? 1 : -1;
        
        // –ü—ã—Ç–∞–µ–º—Å—è –¥–≤–∏–≥–∞—Ç—å—Å—è –∫ —Ñ–∏–Ω–∏—à—É (70% –≤—Ä–µ–º–µ–Ω–∏)
        if (Math.random() > 0.3) {
          // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ/–≤–ª–µ–≤–æ
          const candidatePos = currentPos + targetDirection;
          if (candidatePos >= rowStart && candidatePos <= rowEnd && 
              candidatePos >= 0 && candidatePos < NUM_LEDS &&
              !usedPositions.has(candidatePos)) {
            nextPos = candidatePos;
            solutionPath.push(`–®–∞–≥ ${stepCount}: –î–≤–∏–∂–µ–Ω–∏–µ ${targetDirection > 0 ? '–≤–ø—Ä–∞–≤–æ' : '–≤–ª–µ–≤–æ'} –∫ ${nextPos}`);
          }
        }
        
        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –¥–≤–∏–≥–∞—Ç—å—Å—è –∫ —Ü–µ–ª–∏, –ø—Ä–æ–±—É–µ–º –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
        if (nextPos === currentPos) {
          // –ü—Ä–æ–±—É–µ–º –≤ —Å–ª—É—á–∞–π–Ω–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
          const randomDirection = Math.random() > 0.5 ? 1 : -1;
          const candidatePos = currentPos + randomDirection;
          
          if (candidatePos >= rowStart && candidatePos <= rowEnd && 
              candidatePos >= 0 && candidatePos < NUM_LEDS &&
              !usedPositions.has(candidatePos)) {
            nextPos = candidatePos;
            solutionPath.push(`–®–∞–≥ ${stepCount}: –î–≤–∏–∂–µ–Ω–∏–µ ${randomDirection > 0 ? '–≤–ø—Ä–∞–≤–æ' : '–≤–ª–µ–≤–æ'} –∫ ${nextPos}`);
          } else {
            // –ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ —É–¥–∞–ª–æ—Å—å, –ø–æ–ø—Ä–æ–±—É–µ–º –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ç—Ä–æ–∫—É —á–µ—Ä–µ–∑ –Ω–æ—Ä—É
            break;
          }
        }
        
        // –ü–æ–º–µ—á–∞–µ–º –∫–ª–µ—Ç–∫—É –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—É—é
        if (nextPos !== currentPos) {
          // –°–æ–∑–¥–∞–µ–º —Ç—Ä–æ–ø–∏–Ω–∫—É –∏–ª–∏ –Ω–æ—Ä—É –Ω–∞ —ç—Ç–æ–º –ø—É—Ç–∏
          if (Math.random() > 0.7 && stepCount > 3) { // 30% —à–∞–Ω—Å —Å–æ–∑–¥–∞—Ç—å –Ω–æ—Ä—É
            // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é —Å–µ—Ç—å –∏–∑ 2-3 –Ω–æ—Ä
            const networkSize = 2 + Math.floor(Math.random() * 2); // 2-3 –Ω–æ—Ä—ã
            const network = [nextPos];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–æ—Ä—ã –≤ —Å–µ—Ç–∏
            for (let i = 1; i < networkSize; i++) {
              let holePos;
              let attempts = 0;
              do {
                holePos = Math.floor(Math.random() * (NUM_LEDS - 10)) + 5;
                attempts++;
              } while ((usedPositions.has(holePos) || 
                       Math.abs(holePos - targetPos) < 10) && attempts < 20);
              
              if (holePos && !usedPositions.has(holePos)) {
                network.push(holePos);
                usedPositions.add(holePos);
              }
            }
            
            // –°–æ–∑–¥–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é —Å–µ—Ç—å
            for (let i = 0; i < network.length; i++) {
              const current = network[i];
              const next = network[(i + 1) % network.length];
              networks[current] = next;
            }
            
            solutionPath.push(`–®–∞–≥ ${stepCount}: –ù–æ—Ä–∞ –≤ ${nextPos} –≤–µ–¥–µ—Ç –≤ —Å–µ—Ç—å [${network.join(', ')}]`);
          } else {
            // –°–æ–∑–¥–∞–µ–º —Ç—Ä–æ–ø–∏–Ω–∫—É
            networks[nextPos] = 185;
            solutionPath.push(`–®–∞–≥ ${stepCount}: –¢—Ä–æ–ø–∏–Ω–∫–∞ –Ω–∞ ${nextPos}`);
          }
          
          usedPositions.add(nextPos);
          currentPos = nextPos;
        }
      }
      
      // 2. –°–û–ó–î–ê–ï–ú –°–ï–¢–ò –ù–û–† –° –ë–û–õ–¨–®–ò–ú –ö–û–õ–ò–ß–ï–°–¢–í–û–ú –ü–ï–†–ï–•–û–î–û–í (–¥–ª—è –∑–∞–ø—É—Ç—ã–≤–∞–Ω–∏—è)
      console.log("–°–æ–∑–¥–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –¥–ª—è –∑–∞–ø—É—Ç—ã–≤–∞–Ω–∏—è...");
      const additionalNetworks = [];
      
      for (let n = 0; n < params.numNetworks; n++) {
        const networkSize = params.holesPerNetwork;
        const network = [];
        
        // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç—å –Ω–æ—Ä –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø–æ–ª—è
        for (let i = 0; i < networkSize; i++) {
          let holePos;
          let attempts = 0;
          do {
            // –í—ã–±–∏—Ä–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏ –ø–æ–¥–∞–ª—å—à–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—É—Ç–∏ –∏ —Ñ–∏–Ω–∏—à–∞
            const section = Math.floor(Math.random() * 5);
            holePos = Math.floor(Math.random() * 36) + (section * 36);
            attempts++;
          } while ((usedPositions.has(holePos) || 
                   holePos === 0 || holePos === 179 ||
                   Math.abs(holePos - targetPos) < 15) && attempts < 30);
          
          if (holePos && !usedPositions.has(holePos) && holePos < NUM_LEDS) {
            network.push(holePos);
            usedPositions.add(holePos);
          }
        }
        
        if (network.length >= 2) {
          additionalNetworks.push(network);
          
          // –°–æ–∑–¥–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏
          for (let i = 0; i < network.length; i++) {
            const current = network[i];
            const next = network[(i + 1) % network.length];
            networks[current] = next;
          }
        }
      }
      
      // 3. –†–ê–ó–ú–ï–©–ê–ï–ú –ú–ï–®–ö–ò –í –¢–†–£–î–ù–û–î–û–°–¢–£–ü–ù–´–• –ú–ï–°–¢–ê–•
      console.log("–†–∞–∑–º–µ—â–∞–µ–º –º–µ—à–∫–∏...");
      const bagPositions = [];
      
      for (let i = 0; i < params.numBags; i++) {
        let bagPos;
        let attempts = 0;
        
        do {
          // –ú–µ—à–∫–∏ —Å—Ç–∞–≤–∏–º –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –¥–ª–∏–Ω–Ω—ã—Ö –ø—É—Å—Ç—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤
          bagPos = Math.floor(Math.random() * 170) + 5;
          attempts++;
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–µ—à–æ–∫ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É—Ç—å
          const hasAlternative = checkAlternativePath(bagPos, usedPositions, networks);
          
        } while ((usedPositions.has(bagPos) || 
                 bagPos === 0 || bagPos === 179 ||
                 !hasAlternative) && attempts < 50);
        
        if (bagPos && !usedPositions.has(bagPos) && bagPos < NUM_LEDS) {
          networks[bagPos] = 183;
          usedPositions.add(bagPos);
          bagPositions.push(bagPos);
        }
      }
      
      // 4. –î–û–ë–ê–í–õ–Ø–ï–ú –¢–†–û–ü–ò–ù–ö–ò –î–õ–Ø –°–û–ï–î–ò–ù–ï–ù–ò–Ø –û–ë–õ–ê–°–¢–ï–ô
      console.log("–î–æ–±–∞–≤–ª—è–µ–º —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–æ–ø–∏–Ω–∫–∏...");
      
      // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–æ–ø–∏–Ω–æ–∫, —Å–æ–µ–¥–∏–Ω—è—é—â–∏—Ö —Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–∏ —É—Ä–æ–≤–Ω—è
      for (let p = 0; p < params.numPaths; p++) {
        const pathLength = 3 + Math.floor(Math.random() * 4); // 3-6 –∫–ª–µ—Ç–æ–∫
        let pathStart;
        let attempts = 0;
        
        do {
          // –ù–∞—á–∏–Ω–∞–µ–º —Ç—Ä–æ–ø–∏–Ω–∫—É –æ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
          pathStart = Array.from(usedPositions)[Math.floor(Math.random() * usedPositions.size)];
          attempts++;
        } while ((!pathStart || pathStart > NUM_LEDS - pathLength) && attempts < 30);
        
        if (pathStart) {
          // –°–æ–∑–¥–∞–µ–º —Ç—Ä–æ–ø–∏–Ω–∫—É
          for (let i = 0; i < pathLength && (pathStart + i) < NUM_LEDS; i++) {
            const pos = pathStart + i;
            if (!usedPositions.has(pos) && networks[pos] === 180) {
              networks[pos] = 185;
              usedPositions.add(pos);
            }
          }
        }
      }
      
      // 5. –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú, –ß–¢–û –ü–ï–†–ï–î –§–ò–ù–ò–®–ï–ú –ï–°–¢–¨ –ù–û–†–ê –ò–ó "–î–ê–õ–ï–ö–û–ô" –°–ï–¢–ò
      console.log("–°–æ–∑–¥–∞–µ–º —Å–µ—Ç—å –Ω–æ—Ä –ø–µ—Ä–µ–¥ —Ñ–∏–Ω–∏—à–µ–º...");
      
      // –ù–∞—Ö–æ–¥–∏–º –ø–æ–∑–∏—Ü–∏—é –∑–∞ 3-5 —à–∞–≥–æ–≤ –¥–æ —Ñ–∏–Ω–∏—à–∞
      const preFinishPositions = [];
      for (let i = 1; i <= 5; i++) {
        const pos = 179 - i;
        if (pos > 0 && networks[pos] === 180) {
          preFinishPositions.push(pos);
        }
      }
      
      if (preFinishPositions.length > 0) {
        const preFinishPos = preFinishPositions[Math.floor(Math.random() * preFinishPositions.length)];
        
        // –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å–µ—Ç—å –Ω–æ—Ä, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–∞–ª–µ–∫–æ –æ—Ç —Ñ–∏–Ω–∏—à–∞
        const finalNetwork = [preFinishPos];
        
        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ—Ä—ã –≤ –Ω–∞—á–∞–ª–µ —É—Ä–æ–≤–Ω—è (–¥–∞–ª–µ–∫–æ –æ—Ç —Ñ–∏–Ω–∏—à–∞)
        for (let i = 0; i < 2; i++) {
          let farPos;
          let attempts = 0;
          do {
            farPos = Math.floor(Math.random() * 50) + 10;
            attempts++;
          } while ((usedPositions.has(farPos) || 
                   farPos === preFinishPos) && attempts < 20);
          
          if (farPos && !usedPositions.has(farPos)) {
            finalNetwork.push(farPos);
            usedPositions.add(farPos);
          }
        }
        
        // –°–æ–∑–¥–∞–µ–º —Å–µ—Ç—å
        if (finalNetwork.length >= 2) {
          for (let i = 0; i < finalNetwork.length; i++) {
            const current = finalNetwork[i];
            const next = finalNetwork[(i + 1) % finalNetwork.length];
            networks[current] = next;
          }
          solutionPath.push(`–ü–µ—Ä–µ–¥ —Ñ–∏–Ω–∏—à–µ–º (${preFinishPos}) - –Ω–æ—Ä–∞ –∏–∑ —Å–µ—Ç–∏ [${finalNetwork.join(', ')}]`);
        }
      }
      
      // 6. –ì–ï–ù–ï–†–ò–†–£–ï–ú –ö–û–î –£–†–û–í–ù–Ø
      console.log("–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥...");
      let code = generateLevelCodeFromNetworks(levelNum, levelName, networks, 179);
      
      return {
        networks: networks,
        code: code,
        solution: solutionPath,
        L_FINISH: 179,
        holeNetworks: additionalNetworks
      };
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
    function displayGeneratorSolution(solution) {
      generatorSolutionSteps.innerHTML = '';
      
      solution.forEach((step, index) => {
        const stepEl = document.createElement('div');
        stepEl.className = 'solution-step';
        stepEl.innerHTML = step;
        generatorSolutionSteps.appendChild(stepEl);
      });
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞
    function copyGeneratedCode() {
      const text = generatorCodeOutput.textContent;
      if (!text || text.includes('// –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥')) {
        showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å');
        return;
      }
      
      navigator.clipboard.writeText(text).then(() => {
        const originalText = generatorCopyBtn.textContent;
        generatorCopyBtn.textContent = '‚úì –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        setTimeout(() => {
          generatorCopyBtn.textContent = originalText;
        }, 2000);
        showNotification('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
    function loadGeneratedToEditor() {
      if (!generatedLevelData) {
        showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å');
        return;
      }
      
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      document.querySelector('[data-tab="editor"]').click();
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
      networks = [...generatedLevelData.networks];
      finishPos = generatedLevelData.L_FINISH;
      
      // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–π –Ω–æ—Ä
      holeNetworks = [];
      const visited = new Set();
      for (let i = 0; i < NUM_LEDS; i++) {
        if (networks[i] < 180 && !visited.has(i)) {
          const network = [];
          let current = i;
          
          while (!visited.has(current)) {
            visited.add(current);
            network.push(current);
            current = networks[current];
          }
          
          if (network.length > 1) {
            holeNetworks.push(network);
          }
        }
      }
      
      // –°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–π —Å–æ–∑–¥–∞–≤–∞–µ–º–æ–π —Å–µ—Ç–∏ –∏ —Ä–µ–∂–∏–º–∞
      holeNetwork = [];
      currentMode = 'free';
      currentQuickTool = null;
      smallTools.forEach(t => t.classList.remove('active'));
      
      // –°–±—Ä–æ—Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π –∏–Ω–¥–µ–∫—Å–æ–≤
      showAllIndices = false;
      showHoleIndices = false;
      showAllIndicesCheckbox.checked = false;
      showHoleIndicesCheckbox.checked = false;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      document.getElementById('levelNum').value = generatorLevelNum.value;
      document.getElementById('levelName').value = generatorLevelName.value;
      codeOutput.textContent = generatedLevelData.code;
      
      // –°–±—Ä–æ—Å –ø–∞–Ω–µ–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
      infoPanel.style.display = 'none';
      infoDetails.innerHTML = '';
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ä–µ–∂–∏–º–æ–≤
      updateToolButtons();
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
      updateVisuals();
      
      showNotification('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä');
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è –≤ —ç–º—É–ª—è—Ç–æ—Ä
    function loadGeneratedToEmulator() {
      if (!generatedLevelData) {
        showNotification('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å');
        return;
      }
      
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É —ç–º—É–ª—è—Ç–æ—Ä–∞
      document.querySelector('[data-tab="emulator"]').click();
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —ç–º—É–ª—è—Ç–æ—Ä
      emulatorNetworks = [...generatedLevelData.networks];
      emulatorL_FINISH = generatedLevelData.L_FINISH;
      emulatorCurrPos = 0;
      emulatorGameWon = false;
      isEmulatorCustomLevel = true;
      
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–±–æ—Ä–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å
      emulatorLevelSelect.value = 'custom';
      customLevelSection.style.display = 'block';
      
      // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª—è –∫–æ–¥–∞
      emulatorCustomCode.value = generatedLevelData.code;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      updateEmulatorDisplay();
      emulatorStatus.textContent = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —ç–º—É–ª—è—Ç–æ—Ä';
      showNotification('–£—Ä–æ–≤–µ–Ω—å –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —ç–º—É–ª—è—Ç–æ—Ä');
    }
  </script>
</body>
</html>
